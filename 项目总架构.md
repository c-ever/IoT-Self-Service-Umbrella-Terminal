# åŸºäºQtçš„æ ¡å›­åˆ†å¸ƒå¼è‡ªåŠ©é›¨å…·ç»ˆç«¯ç³»ç»Ÿï¼ˆæ¶æ„ï¼‰

## 1.é¡¹ç›®ç®€ä»‹

### 1.1 ç³»ç»Ÿä»‹ç» (System Introduction)

**RainHub æ ¡å›­æ™ºèƒ½å…±äº«é›¨å…·ç»ˆç«¯ç³»ç»Ÿ** æ˜¯ä¸€æ¬¾åŸºäº **C++ è¯­è¨€** ä¸ **Qt æ¡†æ¶** å¼€å‘çš„åˆ†å¸ƒå¼ç‰©è”ç½‘ï¼ˆIoTï¼‰æ¨¡æ‹Ÿç³»ç»Ÿã€‚æœ¬ç³»ç»Ÿæ—¨åœ¨æ›´å¥½åœ°ä¸ºé«˜æ ¡æ ¡å›­å†…å¸ˆç”Ÿé›¨å¤©å‡ºè¡Œæä¾›æœåŠ¡ï¼Œé€šè¿‡æ•°å­—åŒ–æ‰‹æ®µå®ç°é›¨å…·çš„æ— äººå€¼å®ˆä¸è‡ªåŠ©åŒ–æœåŠ¡ã€‚

ç³»ç»Ÿé‡‡ç”¨ç»å…¸çš„ **C/Sï¼ˆå®¢æˆ·ç«¯/æœåŠ¡ç«¯ï¼‰åˆ†å¸ƒå¼æ¶æ„** è®¾è®¡ï¼š

* **æœåŠ¡ç«¯ï¼ˆServerï¼‰**ï¼šä½œä¸ºä¸­å¤®æ§åˆ¶æ¢çº½ï¼Œè´Ÿè´£å¤„ç†å¤šç»ˆç«¯çš„é«˜å¹¶å‘è¿æ¥ã€ç”¨æˆ·ä¿¡æ¯é‰´æƒã€é›¨å…·åº“å­˜è°ƒåº¦ä»¥åŠæŒä¹…åŒ–æ•°æ®å­˜å‚¨ï¼ˆSQLiteï¼‰ã€‚
* **å®¢æˆ·ç«¯ï¼ˆClientï¼‰**ï¼šéƒ¨ç½²äºæ¨¡æ‹Ÿç»ˆç«¯è®¾å¤‡ï¼Œæä¾›è§¦æ§å¯è§†åŒ–äº¤äº’ç•Œé¢ï¼Œå¹¶é€šè¿‡è½¯ä»¶é€»è¾‘æ¨¡æ‹ŸçœŸå®çš„ç¡¬ä»¶åŠ¨ä½œï¼ˆå¦‚ç”µç£é”æ‰£çš„å¼¹å¼€ä¸é—­åˆã€åº“å­˜çŠ¶æ€çš„å®æ—¶å˜æ›´ï¼‰ã€‚

åœ¨æŠ€æœ¯å®ç°ä¸Šï¼Œæœ¬é¡¹ç›®æ·±åº¦åº”ç”¨äº† **é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰** æ€æƒ³ï¼Œå¯¹â€œé›¨ä¼â€ã€â€œé›¨è¡£â€ç­‰ä¸åŒé›¨å…·è¿›è¡Œäº†ç»§æ‰¿ä¸å¤šæ€è®¾è®¡ï¼›åˆ©ç”¨ **TCP Socket ç½‘ç»œç¼–ç¨‹** æŠ€æœ¯ï¼Œå®ç°äº†ç»ˆç«¯ä¸äº‘ç«¯çš„æ¯«ç§’çº§çŠ¶æ€åŒæ­¥ã€‚ç³»ç»Ÿä¸ä»…æ¨¡æ‹Ÿäº†çœŸå®çš„å•†ä¸šçº§è‡ªåŠ©è®¾å¤‡æ“ä½œæµç¨‹ï¼Œè¿˜é›†æˆäº†åœ¨çº¿å®¢æœã€æ•…éšœä¸ŠæŠ¥ç­‰è¾…åŠ©åŠŸèƒ½ï¼Œæ˜¯ä¸€å¥—å®Œæ•´çš„æ ¡å›­ç‰©è”ç½‘è§£å†³æ–¹æ¡ˆã€‚

### 1.2ç³»ç»Ÿæ¨¡æ‹Ÿä½¿ç”¨åœºæ™¯

<div align="center">
    <img src="./æ¨¡æ‹Ÿç¡¬ä»¶è®¾å¤‡å›¾.png" width="80%" />
    <br>
    <div style="color:gray; font-size: 14px; padding: 10px;">
        å›¾ 1-1 RainHub æ™ºèƒ½è‡ªåŠ©é›¨å…·ç»ˆç«¯å¤–è§‚è®¾è®¡å›¾
    </div>
</div>




## 2. ç³»ç»Ÿæ€»ä½“æ¶æ„è®¾è®¡ (System Architecture Design)

### 2.1 æ€»ä½“æ¶æ„æ¨¡å¼ (Overall Architecture)
æœ¬ç³»ç»Ÿé‡‡ç”¨æ ‡å‡†çš„ **C/S (Client/Server)** åˆ†å¸ƒå¼æ¶æ„ï¼Œå°†ç³»ç»Ÿé€»è¾‘åˆ’åˆ†ä¸ºâ€œæœåŠ¡ç«¯â€ä¸â€œå®¢æˆ·ç«¯â€ä¸¤éƒ¨åˆ†ï¼ŒäºŒè€…é€šè¿‡ TCP/IP åè®®è¿›è¡Œæ•°æ®é€šä¿¡ã€‚

* **æœåŠ¡ç«¯ (Server Layer)**ï¼šä½œä¸ºç³»ç»Ÿçš„â€œå¤§è„‘â€ï¼Œæ‰¿æ‹…æ•°æ®æŒä¹…åŒ–ã€ä¸šåŠ¡é€»è¾‘å¤„ç†åŠå¤šç»ˆç«¯å¹¶å‘ç®¡ç†çš„èŒè´£ã€‚
* **å®¢æˆ·ç«¯ (Client Layer)**ï¼šä½œä¸ºç³»ç»Ÿçš„â€œæ‰‹è„šâ€ï¼Œè¿è¡Œäºæ™ºèƒ½ç»ˆç«¯ç¡¬ä»¶ä¸Šï¼Œè´Ÿè´£ç”¨æˆ·äº¤äº’ (UI)ã€ç¡¬ä»¶çŠ¶æ€æ¨¡æ‹ŸåŠæŒ‡ä»¤å‘é€ã€‚
* **ç½‘ç»œå±‚ (Network Layer)**ï¼šåŸºäº Qt Network æ¨¡å—å®ç°çš„ Socket é€šä¿¡é“¾è·¯ï¼Œç¡®ä¿æŒ‡ä»¤ä¼ è¾“çš„å®æ—¶æ€§ä¸å¯é æ€§ã€‚

### 2.2 è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼šMVC åˆ†å±‚è®¾è®¡
ä¸ºäº†é™ä½ä»£ç è€¦åˆåº¦ï¼Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ä¸æ‰©å±•æ€§ï¼Œæœ¬ç³»ç»Ÿåœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„è®¾è®¡ä¸­å‡å¼•å…¥äº† **MVC (Model-View-Controller)** è®¾è®¡æ¨¡å¼çš„æ€æƒ³ï¼š

1.  **æ¨¡å‹å±‚ (Model)**ï¼š
    * è´Ÿè´£æ•°æ®çš„å®šä¹‰ä¸å­˜å‚¨ã€‚
    * *åŒ…å«ç±»*ï¼š`User` (ç”¨æˆ·ç±»)ã€`RainGear` (é›¨å…·åŸºç±»)ã€`Umbrella/Raincoat` (æ´¾ç”Ÿç±»)ã€‚
    * *èŒè´£*ï¼šä»…ä¿å­˜æ•°æ®çŠ¶æ€ï¼ˆå¦‚é›¨ä¼æ˜¯å¦æŸåã€ç”¨æˆ·ä½™é¢å¤šå°‘ï¼‰ï¼Œä¸åŒ…å«ä»»ä½•ç•Œé¢é€»è¾‘ã€‚

2.  **è§†å›¾å±‚ (View)**ï¼š
    * è´Ÿè´£æ•°æ®çš„å¯è§†åŒ–å±•ç¤ºä¸ç”¨æˆ·äº¤äº’ã€‚
    * *åŒ…å«ç±»*ï¼š`MainWindow` (ä¸»ç•Œé¢)ã€`LoginDialog` (ç™»å½•çª—å£)ã€`ChatWidget` (å®¢æœèŠå¤©çª—)ã€‚
    * *èŒè´£*ï¼šä½¿ç”¨ Qt Designer ç»˜åˆ¶ï¼Œé€šè¿‡ä¿¡å·ä¸æ§½ (Signal & Slot) æ¥æ”¶ç”¨æˆ·ç‚¹å‡»äº‹ä»¶ï¼Œå¹¶å°†æ“ä½œåé¦ˆç»™æ§åˆ¶å±‚ã€‚

3.  **æ§åˆ¶å±‚ (Controller)**ï¼š
    * è´Ÿè´£ä¸šåŠ¡é€»è¾‘çš„è°ƒåº¦ä¸ç½‘ç»œé€šä¿¡ã€‚
    * *åŒ…å«ç±»*ï¼š`RainHubController` (æ ¸å¿ƒä¸šåŠ¡æ§åˆ¶å™¨)ã€`NetworkManager` (ç½‘ç»œç®¡å®¶)ã€‚
    * *èŒè´£*ï¼šæ¥æ”¶è§†å›¾å±‚çš„æŒ‡ä»¤ï¼ˆå¦‚â€œç”¨æˆ·ç‚¹å‡»å€Ÿä¼â€ï¼‰ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚â€œåˆ¤æ–­ä½™é¢æ˜¯å¦å……è¶³â€ï¼‰ï¼Œå¹¶é€šçŸ¥æ¨¡å‹å±‚æ›´æ–°æ•°æ®ã€‚

### 2.3 æ•°æ®åº“è®¾è®¡ç­–ç•¥ (Database Strategy)
ä¸ºäº†ä¿è¯æ•°æ®çš„é«˜å¯ç”¨æ€§ä¸å¤šç”¨æˆ·å¹¶å‘è®¿é—®çš„ç¨³å®šæ€§ï¼Œæœ¬ç³»ç»ŸæœåŠ¡ç«¯é‡‡ç”¨å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ **MySQL** ä½œä¸ºæ•°æ®å­˜å‚¨ä¸­å¿ƒã€‚

* **æŠ€æœ¯é€‰å‹**ï¼šä½¿ç”¨ Qt SQL æ¨¡å—æä¾›çš„ `QMYSQL` é©±åŠ¨è¿›è¡Œè¿æ¥ã€‚ç›¸æ¯”äºè½»é‡çº§çš„ SQLiteï¼ŒMySQL æ”¯æŒæ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ä¸äº‹åŠ¡å¤„ç†ï¼Œç¬¦åˆæœåŠ¡ç«¯é›†ä¸­å¼ç®¡ç†çš„è®¾è®¡è¦æ±‚ã€‚
* **DAO æ¨¡å¼å°è£…**ï¼š
    * **DatabaseManager ç±»**ï¼šå°è£…æ•°æ®åº“è¿æ¥æ± ï¼Œè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„ Hostã€Portã€Userã€Password ç­‰å‚æ•°è¿æ¥ MySQL æœåŠ¡ã€‚
    * **æ•°æ®éš”ç¦»**ï¼šæ‰€æœ‰ SQL æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰å‡åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œå®¢æˆ·ç«¯ä»…é€šè¿‡ TCP ç½‘ç»œåè®®è¯·æ±‚æ•°æ®ï¼Œä¸ç›´æ¥æ¥è§¦æ•°æ®åº“ï¼Œç¡®ä¿äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚





## 3. ç³»ç»Ÿè¯¦ç»†è®¾è®¡ (Detailed Design)

### 3.1 å®¢æˆ·ç«¯è§†å›¾å±‚è®¾è®¡ (View Layer Design)
æœ¬ç³»ç»Ÿå®¢æˆ·ç«¯ç•Œé¢åŸºäº **Qt Widgets** æŠ€æœ¯æ ˆæ„å»ºï¼Œé‡‡ç”¨ `QStackedWidget` å®¹å™¨å®ç°å¤šé¡µé¢é—´çš„å¹³æ»‘è·³è½¬ã€‚ç•Œé¢è®¾è®¡éµå¾ªâ€œæç®€äº¤äº’â€åŸåˆ™ï¼Œç¡®ä¿ç”¨æˆ·åœ¨ 3 æ­¥ä¹‹å†…å³å¯å®Œæˆæ ¸å¿ƒä¸šåŠ¡æ“ä½œã€‚åŒæ—¶ï¼Œä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼ˆUXï¼‰ï¼Œç³»ç»Ÿå¼•å…¥äº† **Qt Animation Framework** å®ç°åŠ¨æ€ UI æ•ˆæœã€‚

* **å…¨å±€å¯¼èˆªè®¾è®¡**ï¼šé™¤â€œåˆå§‹å¼•å¯¼é¡µâ€å¤–ï¼Œæ‰€æœ‰å­é¡µé¢çš„å·¦ä¸Šè§’å‡å›ºå®šè®¾ç½®ä¸€ä¸ª **[< è¿”å›]** æŒ‰é’® (Back Button)ã€‚
* **åŠŸèƒ½**ï¼šç‚¹å‡»è¯¥æŒ‰é’®å¯ç«‹å³ä¸­æ–­å½“å‰æ“ä½œå¹¶è¿”å›ä¸Šä¸€çº§ç•Œé¢ï¼Œç¬¦åˆç‰©ç†æ“ä½œç›´è§‰ã€‚

#### 3.1.1 å¯åŠ¨ä¸ç™»å½•æ¨¡å— (Startup & Login Module)
è¯¥æ¨¡å—åŒ…å«å››ä¸ªè¿ç»­è·³è½¬çš„å­é¡µé¢ï¼Œè´Ÿè´£å¼•å¯¼ç”¨æˆ·è¿›å…¥ç³»ç»Ÿå¹¶å®Œæˆèº«ä»½é‰´æƒã€‚

**1. åˆå§‹å¼•å¯¼é¡µ (WelcomePage)**
* **é¡µé¢å¸ƒå±€**ï¼šå‚ç›´å±…ä¸­å¸ƒå±€ (`QVBoxLayout` + `Qt::AlignCenter`)ã€‚
* **è§†è§‰å…ƒç´ **ï¼š
    * **ä¸»æ ‡é¢˜**ï¼šå±å¹•ä¸­ä¸Šéƒ¨æ˜¾ç¤º **â€œNUISTæ™ºèƒ½è‡ªåŠ©é›¨å…·ç³»ç»Ÿâ€**ï¼Œé‡‡ç”¨å¤§å­—å·åŠ ç²—å­—ä½“ã€‚
    * **å‰¯æ ‡é¢˜**ï¼šä¸»æ ‡é¢˜ä¸‹æ–¹æ˜¾ç¤º **â€œæ¬¢è¿æ‚¨çš„ä½¿ç”¨â€**ï¼Œå­—å·ç¨å°ï¼Œèµ·åˆ°äº²åˆ‡å¼•å¯¼ä½œç”¨ã€‚
    * **æ“ä½œå…¥å£**ï¼šé¡µé¢åº•éƒ¨è®¾ç½® **[å¼€å§‹ä½¿ç”¨]** æŒ‰é’®ã€‚
* **äº¤äº’é€»è¾‘**ï¼šç‚¹å‡»æŒ‰é’®è§¦å‘ä¿¡å·ï¼Œè·³è½¬è‡³â€œèº«ä»½é€‰æ‹©é¡µâ€ã€‚

**2. èº«ä»½éªŒè¯é€‰æ‹©é¡µ (IdentityPage)**
* **é¡µé¢å¸ƒå±€**ï¼šæ•´ä½“å±…ä¸­ã€‚
* **è§†è§‰å…ƒç´ **ï¼š
    * **æç¤ºè¯­**ï¼šé¡µé¢ä¸­å¤®æ˜¾ç¤º **â€œæ‚¨çš„èº«ä»½æ˜¯ï¼Ÿâ€**ã€‚
    * **é€‰æ‹©åŒº**ï¼šä¸‹æ–¹å¹¶æ’è®¾ç½®ä¸¤ä¸ªå¤§å°ºå¯¸æŒ‰é’® â€”â€” **[æ•™èŒäººå‘˜]** ä¸ **[å­¦ç”Ÿ]**ã€‚
* **äº¤äº’é€»è¾‘**ï¼šç‚¹å‡»ä»»ä¸€æŒ‰é’®ï¼Œç³»ç»Ÿå°†ä¸´æ—¶è®°å½•å½“å‰ç”¨æˆ·è§’è‰²ï¼ˆRoleï¼‰ï¼Œå¹¶æ ¹æ®é€‰æ‹©è·³è½¬è‡³åŒä¸€æ¨¡æ¿ä½†æ ‡ç­¾ä¸åŒçš„â€œç™»å½•é¡µâ€ã€‚

**3. ç”¨æˆ·ç™»å½•é¡µ (LoginPage)**
* **é¡µé¢å¸ƒå±€**ï¼šè¡¨å•å¼å¸ƒå±€ (`QFormLayout`)ï¼Œæ•´ä½“å±…ä¸­æ˜¾ç¤ºã€‚
* **è§†è§‰å…ƒç´ **ï¼š
    * **è´¦å·è¾“å…¥**ï¼š
        * **æ ‡ç­¾**ï¼šæ ¹æ®ä¸Šä¸€é¡µçš„é€‰æ‹©åŠ¨æ€æ˜¾ç¤º â€œè¯·è¾“å…¥æ‚¨çš„å­¦å·ï¼šâ€ æˆ– â€œè¯·è¾“å…¥æ‚¨çš„å·¥å·ï¼šâ€ã€‚
        * **è¾“å…¥æ¡†**ï¼šå³ä¾§è·Ÿéšä¸€ä¸ª `QLineEdit` è¾“å…¥æ¡†ã€‚
    * **å¯†ç è¾“å…¥**ï¼š
        * **æ ‡ç­¾**ï¼šæ˜¾ç¤º â€œå¯†ç ï¼šâ€ã€‚
        * **è¾“å…¥æ¡†**ï¼šè®¾ç½®ä¸ºå¯†æ–‡æ¨¡å¼ (`EchoMode::Password`)ï¼Œé»˜è®¤éªŒè¯é€»è¾‘åŸºäºåˆå§‹å¯†ç  `123456`ã€‚
    * **è¾…åŠ©åŠŸèƒ½**ï¼šè¾“å…¥æ¡†ç»„çš„å³ä¸‹è§’è®¾ç½®ä¸€ä¸ªçº¯æ–‡æœ¬é£æ ¼çš„å°æŒ‰é’® **[ä¿®æ”¹å¯†ç ]**ã€‚
* **äº¤äº’é€»è¾‘**ï¼š
    * ç‚¹å‡» **[ç™»å½•]**ï¼šæäº¤è´¦å·å¯†ç è‡³æ§åˆ¶å±‚æ ¡éªŒï¼ŒæˆåŠŸåˆ™è¿›å…¥ä¸»ç³»ç»Ÿï¼Œå¤±è´¥å¼¹å‡ºæç¤ºã€‚
    * ç‚¹å‡» **[ä¿®æ”¹å¯†ç ]**ï¼šè·³è½¬è‡³â€œé‡ç½®å¯†ç é¡µâ€ã€‚

**4. å¯†ç é‡ç½®é¡µ (ResetPwdPage)**
* **é¡µé¢å¸ƒå±€**ï¼šå‚ç›´åˆ—è¡¨å¸ƒå±€ï¼Œå¼ºè°ƒç®€æ´æ€§ã€‚
* **è§†è§‰å…ƒç´ **ï¼š
    * **é¡µé¢æ ‡é¢˜**ï¼šé¡¶éƒ¨å±…ä¸­æ˜¾ç¤º â€œé‡ç½®å¯†ç â€ å››ä¸ªå­—ã€‚
    * **è¾“å…¥æ§ä»¶**ï¼šé‡‡ç”¨ **å ä½ç¬¦æ–‡æœ¬ (PlaceholderText)** è®¾è®¡ï¼Œæ–‡å­—ç›´æ¥æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†å†…éƒ¨ï¼Œä¸é¢å¤–è®¾ç½®å·¦ä¾§æ ‡ç­¾ã€‚
        * **è¾“å…¥æ¡† A**ï¼šå†…éƒ¨ç°è‰²æ–‡å­—æç¤º â€œé»˜è®¤å¯†ç â€ï¼ˆç”¨äºéªŒè¯æ—§å¯†ç ï¼‰ã€‚
        * **è¾“å…¥æ¡† B**ï¼šå†…éƒ¨ç°è‰²æ–‡å­—æç¤º â€œç¡®è®¤å¯†ç â€ï¼ˆç”¨äºè¾“å…¥æ–°å¯†ç ï¼‰ã€‚
* **äº¤äº’é€»è¾‘**ï¼šæ ¡éªŒé€šè¿‡åæ›´æ–°æ•°æ®åº“ä¸­çš„å¯†ç å­—æ®µï¼Œå¹¶è‡ªåŠ¨è¿”å›ç™»å½•é¡µã€‚

#### 3.1.2 ä¸»åŠŸèƒ½èœå•æ¨¡å— (Main Dashboard Module)
ç”¨æˆ·ç™»å½•æˆåŠŸåè¿›å…¥çš„æ ¸å¿ƒå¯¼èˆªç•Œé¢ï¼Œè¯¥é¡µé¢å¼ºè°ƒåŠ¨æ€äº¤äº’ä¸ä¿¡æ¯èšåˆã€‚

**1. é¡µé¢å¸ƒå±€ä¸åŠ¨æ•ˆ (Layout & Animation)**
* **é¡¶éƒ¨æ **ï¼šå±…ä¸­æ˜¾ç¤ºç³»ç»Ÿåç§° **â€œNUISTæ™ºèƒ½é›¨å…·ç³»ç»Ÿâ€**ï¼Œå­—ä½“é†’ç›®ã€‚
* **ä¸­å¤®äº¤äº’åŒºï¼ˆåŠ¨æ€æ ¸å¿ƒï¼‰**ï¼š
    * **å€Ÿè¿˜å…¥å£**ï¼šåŒ…å«ä¸¤ä¸ªè¶…å¤§å°ºå¯¸çš„åœ†å½¢æˆ–åœ†è§’çŸ©å½¢æŒ‰é’® â€”â€” **[æˆ‘è¦å€Ÿä¼]** ä¸ **[æˆ‘è¦è¿˜ä¼]**ï¼Œä¸­é—´é€šè¿‡è‰ºæœ¯å­— **â€œORâ€** è¿æ¥ã€‚
    * **å…¥åœºåŠ¨ç”»**ï¼šåˆ©ç”¨ `QPropertyAnimation` å®ç°â€œåº•éƒ¨æ»‘å…¥â€æ•ˆæœã€‚å½“é¡µé¢åŠ è½½æ—¶ï¼Œè¿™ä¸¤ä¸ªæ ¸å¿ƒæŒ‰é’®ä¼šä»å±å¹•åº•éƒ¨è¾¹ç¼˜å¹³æ»‘å‡èµ·è‡³å±å¹•ä¸­å¤®ï¼Œå¢åŠ ç§‘æŠ€æ„Ÿä¸åŠ¨æ„Ÿã€‚
    * **è¯´æ˜å…¥å£**ï¼šåœ¨å€Ÿè¿˜æŒ‰é’®ä¸‹æ–¹ï¼Œè®¾ç½® **[ä½¿ç”¨è¯´æ˜]** æ–‡æœ¬æŒ‰é’®ï¼Œç‚¹å‡»è·³è½¬è‡³è¯´æ˜é¡µã€‚
* **åº•éƒ¨åŠŸèƒ½åŒº**ï¼šé‡‡ç”¨ä¸¤ç«¯å¯¹é½å¸ƒå±€ï¼Œæ”¾ç½®ä¸¤ä¸ª **æ¤­åœ†å½¢ (Capsule Shape)** æŒ‰é’®ï¼Œä½¿ç”¨ Qt Style Sheets (`border-radius`) å®ç°åœ†æ¶¦è§†è§‰ã€‚
    * å·¦ä¸‹è§’ï¼š**[ğŸ‘¤ ä¸ªäººä¸­å¿ƒ]** æŒ‰é’®ã€‚
    * å³ä¸‹è§’ï¼š**[ğŸ—ºï¸ æŸ¥çœ‹åœ°å›¾]** æŒ‰é’®ã€‚

**2. äº¤äº’é€»è¾‘**
* ç‚¹å‡» **[å€Ÿ] / [è¿˜]**ï¼šè·³è½¬è‡³å¯¹åº”çš„é›¨å…·æ§½ä½é€‰æ‹©ç•Œé¢ï¼ˆå³ç¡¬ä»¶æ¨¡æ‹Ÿç•Œé¢ï¼‰ã€‚
* ç‚¹å‡» **[ä¸ªäººä¸­å¿ƒ]**ï¼šè·³è½¬è‡³ç”¨æˆ·ä¿¡æ¯é¡µã€‚
* ç‚¹å‡» **[æŸ¥çœ‹åœ°å›¾]**ï¼šè·³è½¬è‡³æ ¡å›­ç½‘ç‚¹åœ°å›¾é¡µã€‚

#### 3.1.3 è¾…åŠ©åŠŸèƒ½å­é¡µé¢ (Sub-Feature Pages)
æœ¬èŠ‚æè¿°ä¸»èœå•ä¸‹å±çš„ä¸‰ä¸ªè¾…åŠ©åŠŸèƒ½æ¨¡å—ï¼Œåˆ†åˆ«æ‰¿æ‹…ç”¨æˆ·çŠ¶æ€å±•ç¤ºã€è§„åˆ™è¯´æ˜åŠåœ°ç†ä¿¡æ¯å¯è§†åŒ–åŠŸèƒ½ã€‚

**1. ä¸ªäººä¿¡æ¯é¡µ (UserProfilePage)**

* **æ•°æ®æ¥æº**ï¼šç³»ç»Ÿæ ¹æ®ç™»å½•æ—¶ç»‘å®šçš„æ ¡å›­å¡/èŒå·¥å¡ IDï¼Œé€šè¿‡ `UserDAO` ä»æ•°æ®åº“åŠ¨æ€åŠ è½½ã€‚
* **UI æ„æˆ**ï¼š
    * **é¡¶éƒ¨åŒºåŸŸ**ï¼šæ˜¾ç¤ºç”¨æˆ·å¤´åƒï¼ˆæ ¹æ® Role å­—æ®µåŠ è½½é»˜è®¤çš„å­¦ç”Ÿæˆ–æ•™å¸ˆå¤´åƒï¼‰ã€‚
    * **æ ¸å¿ƒæ•°æ®åŒº**ï¼šé‡‡ç”¨å››è¡Œå‚ç›´æ’åˆ—çš„å¤§å­—ä½“å±•ç¤ºï¼š
        1.  **æ ‡é¢˜**ï¼šâ€œä¸ªäººä¿¡æ¯â€ (Font: Bold, 24pt)ã€‚
        2.  **å§“å**ï¼šâ€œå¼ ä¸‰â€ ï¼ˆå¯¹åº”æ•°æ®åº“å­—æ®µ `name`ï¼‰ã€‚
        3.  **ID**ï¼šâ€œå­¦å·ï¼š2023xxxxâ€ ï¼ˆå¯¹åº”æ•°æ®åº“å­—æ®µ `uid`ï¼‰ã€‚
        4.  **èµ„äº§**ï¼šâ€œè´¦æˆ·ä½™é¢ï¼šï¿¥50.00â€ ï¼ˆå¯¹åº”æ•°æ®åº“å­—æ®µ `balance`ï¼‰ã€‚
* **äº¤äº’ç»†èŠ‚**ï¼šè‹¥ä½™é¢ä½äº 20.00å…ƒï¼Œå­—ä½“é¢œè‰²è‡ªåŠ¨åˆ‡æ¢ä¸ºçº¢è‰² (`#e74c3c`) ä»¥ç¤ºé¢„è­¦ã€‚
* **äº¤äº’é€»è¾‘**ï¼šåº•éƒ¨è®¾æœ‰ **[åˆ·æ–°ä½™é¢]** æŒ‰é’®ï¼Œç‚¹å‡»åå‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œæ¨¡æ‹Ÿä»ä¸€å¡é€šä¸­å¿ƒåŒæ­¥æœ€æ–°æ•°æ®çš„è¿‡ç¨‹ã€‚

**2. ä½¿ç”¨è¯´æ˜é¡µ (InstructionPage)**

* **å¯¹åº”ç±»å**ï¼š`HelpWidget`
* **UI æ„æˆ**ï¼š
    * **å†…å®¹åŒº**ï¼šä¸­å¤®ä¸ºä¸€ä¸ªå¤§é¢ç§¯çš„ `QTextBrowser`ï¼ˆåªè¯»æ–‡æœ¬æ¡†ï¼‰ã€‚
    * **æ“ä½œåŒº**ï¼šåº•éƒ¨ä¸º **[æˆ‘å·²é˜…è¯»]** æŒ‰é’®ï¼Œç‚¹å‡»è¿”å›ä¸»èœå•ã€‚
* **æ–‡æœ¬å†…å®¹ (HTML æ ¼å¼)**ï¼šä¸ºäº†ä¿è¯æ’ç‰ˆç¾è§‚ï¼ˆæ ‡é¢˜åŠ ç²—ã€é‡ç‚¹é«˜äº®ï¼‰ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹ HTML ä»£ç å¡«å……æ–‡æœ¬æ¡†ï¼š

```html
<h2 align="center">NUIST æ™ºèƒ½é›¨å…·ç³»ç»ŸæœåŠ¡åè®®</h2>
<hr>

<h3>ä¸€ã€ æœåŠ¡å¯¹è±¡</h3>
<p>æœ¬ç³»ç»Ÿä»…é¢å‘ NUIST åœ¨æ ¡æ•™èŒå·¥ä¸å­¦ç”Ÿå¼€æ”¾ï¼Œç™»å½•éœ€éªŒè¯æ ¡å›­ä¸€å¡é€šè´¦æˆ·ã€‚</p>

<h3>äºŒã€ å€Ÿè¿˜è§„åˆ™</h3>
<p><b>1. å€Ÿå‡ºï¼š</b>è´¦æˆ·ä½™é¢éœ€å¤§äº <b>20.00å…ƒ</b> æ–¹å¯ä½¿ç”¨ã€‚å€Ÿå‡ºæ—¶ç³»ç»Ÿå°†å†»ç»“ç›¸åº”é‡‘é¢ä½œä¸ºæŠ¼é‡‘ã€‚</p>
<p><b>2. å½’è¿˜ï¼š</b>è¯·å°†é›¨å…·æ’å…¥ä»»æ„ç«™ç‚¹çš„ç©ºé—²å¡æ§½ï¼Œå¬åˆ°â€œå’”å“’â€ä¸Šé”å£°å¹¶çœ‹åˆ°å±å¹•æç¤ºâ€œå½’è¿˜æˆåŠŸâ€åæ–¹å¯ç¦»å¼€ã€‚</p>

<h3>ä¸‰ã€ èµ„è´¹æ ‡å‡† (è‡ªåŠ¨æ‰£æ¬¾)</h3>
<ul>
    <li><b>æ™®é€šé›¨ä¼/ä¸€æ¬¡æ€§é›¨è¡£ï¼š</b> æŠ¼é‡‘ 20å…ƒã€‚</li>
    <li><b>é«˜çº§æŠ—é£ä¼/åŠ åšé›¨è¡£ï¼š</b> æŠ¼é‡‘ 50å…ƒã€‚</li>
    <li><b>å…è´¹æ—¶é•¿ï¼š</b> å€Ÿå‡ºå <b>24å°æ—¶å†…</b> å½’è¿˜å…è´¹ã€‚</li>
    <li><b>è¶…æ—¶è´¹ç”¨ï¼š</b> è¶…è¿‡24å°æ—¶ï¼ŒæŒ‰ <b>1å…ƒ/12å°æ—¶</b> ä»ä½™é¢æ‰£é™¤ï¼Œç›´è‡³æ‰£å®ŒæŠ¼é‡‘ã€‚</li>
</ul>

<h3>å››ã€ é—å¤±ä¸æŸå</h3>
<p>è‹¥é›¨å…·é—å¤±æˆ–ä¸¥é‡æŸåå¯¼è‡´æ— æ³•å½’è¿˜ï¼Œç³»ç»Ÿå°†<b>æ‰£é™¤å…¨é¢æŠ¼é‡‘</b>ç”¨äºèµ”å¿ã€‚</p>

<h3>äº”ã€ è”ç³»æˆ‘ä»¬</h3>
<p>å¦‚é‡è®¾å¤‡æ•…éšœæˆ–æ‰£è´¹å¼‚å¸¸ï¼Œè¯·ç‚¹å‡»ä¸»é¡µå·¦ä¾§çš„<b>ã€è”ç³»å®¢æœã€‘</b>æŒ‰é’®ï¼Œæˆ–è‡´ç”µæ ¡å›­æœåŠ¡ä¸­å¿ƒï¼š8888-1234ã€‚</p>
```

#### 3.1.4 å€Ÿè¿˜ä¸šåŠ¡äº¤äº’é¡µ (Borrow/Return Interface)
æœ¬é¡µé¢ä¸ºç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡çª—å£ï¼Œæ—¨åœ¨é€šè¿‡è½¯ä»¶ç•Œé¢æ¨¡æ‹ŸçœŸå®çš„ç¡¬ä»¶æŸœé—¨çŠ¶æ€ã€‚è®¾è®¡é‡ç‚¹åœ¨äºåˆ©ç”¨ Qt çš„è‡ªå®šä¹‰æ§ä»¶æŠ€æœ¯ï¼Œç›´è§‚åœ°å±•ç¤ºâ€œå¤šæ€é›¨å…·â€çš„åº“å­˜æƒ…å†µä¸å¡æ§½çŠ¶æ€ã€‚

* **é¡µé¢å¸ƒå±€ç­–ç•¥**ï¼šé‡‡ç”¨ **Grid Layout (ç½‘æ ¼å¸ƒå±€)** æ¨¡æ‹Ÿç‰©ç†æœºæŸœçš„çŸ©é˜µæ’åˆ—ï¼ˆæ ‡å‡†è®¾è®¡ä¸º 3è¡Œ x 4åˆ—ï¼Œå…± 12 ä¸ªç‰©ç†æ§½ä½ï¼‰ã€‚

**1. æ ¸å¿ƒæ§ä»¶ï¼šè‡ªå®šä¹‰æ§½ä½å•å…ƒ (SlotItem Widget)**
ä¸ºäº†å®ç°é«˜åº¦å®šåˆ¶åŒ–çš„è§†è§‰æ•ˆæœï¼Œä¸ä½¿ç”¨æ ‡å‡†çš„ `QPushButton`ï¼Œè€Œæ˜¯ç»§æ‰¿ `QWidget` å°è£…ä¸€ä¸ªè‡ªå®šä¹‰æ§ä»¶ç±» `SlotItem`ã€‚

* **è§†è§‰æ„æˆ**ï¼š
    * **èƒŒæ™¯å®¹å™¨**ï¼šåœ†è§’çŸ©å½¢å¡ç‰‡ï¼Œé¢œè‰²æ ¹æ®çŠ¶æ€åŠ¨æ€å˜åŒ–ã€‚
    * **ä¸­å¤®å›¾æ ‡**ï¼šæ ¹æ® `RainGear` å¯¹è±¡çš„å…·ä½“ç±»å‹ï¼ˆOOPå¤šæ€ï¼‰ï¼ŒåŠ è½½ä¸åŒèµ„æºå›¾ç‰‡ï¼š
        * `StandardUmbrella`ï¼ˆæ™®é€šä¼ï¼‰ï¼šæ˜¾ç¤º â˜”ï¸ é»‘è‰²ç®€çº¦ä¼å›¾æ ‡ã€‚
        * `PremiumUmbrella`ï¼ˆé«˜çº§ä¼ï¼‰ï¼šæ˜¾ç¤º â˜‚ï¸ é‡‘è‰²/åŒå±‚ä¼å›¾æ ‡ï¼ˆä»¥æ­¤ä½“ç°ç»§æ‰¿ç±»çš„å·®å¼‚ï¼‰ã€‚
        * `Raincoat`ï¼ˆé›¨è¡£ï¼‰ï¼šæ˜¾ç¤º ğŸ§¥ æŠ˜å é›¨è¡£å›¾æ ‡ã€‚
    * **ç¼–å·æ ‡ç­¾**ï¼šå·¦ä¸Šè§’æ˜¾ç¤ºæ§½ä½ç‰©ç†ç¼–å·ï¼ˆå¦‚ `#01`, `#02`ï¼‰ã€‚
    * **ä»·æ ¼/ç±»å‹æ ‡ç­¾**ï¼šåº•éƒ¨å°å­—æ˜¾ç¤ºå…·ä½“å“ç±»åç§°ï¼ˆå¦‚â€œæŠ—é£ä¼â€ï¼‰ã€‚
* **çŠ¶æ€ä¸é¢œè‰²æ˜ å°„ (State-Color Mapping)**ï¼š
    ç³»ç»Ÿé€šè¿‡ CSS æ ·å¼è¡¨ (`setStyleSheet`) åŠ¨æ€åˆ‡æ¢èƒŒæ™¯è‰²ä»¥åæ˜ ç¡¬ä»¶çŠ¶æ€ï¼š
    * ğŸŸ¢ **å¯å€ŸçŠ¶æ€ (Available)**ï¼šèƒŒæ™¯è‰² `#2ecc71` (ç»¿è‰²)ã€‚è¡¨ç¤ºæ§½ä½å†…æœ‰é›¨å…·ï¼Œä¸”é”æ‰£å·²é—­åˆã€‚
    * âšªï¸ **å¯è¿˜çŠ¶æ€ (Empty)**ï¼šèƒŒæ™¯è‰² `#bdc3c7` (ç°è‰²)ã€‚è¡¨ç¤ºæ§½ä½ä¸ºç©ºï¼Œç­‰å¾…ç”¨æˆ·æ’å…¥é›¨å…·ã€‚
    * ğŸ”´ **æ•…éšœ/ç»´æŠ¤ (Maintenance)**ï¼šèƒŒæ™¯è‰² `#e74c3c` (çº¢è‰²)ã€‚è¡¨ç¤ºç¡¬ä»¶æŠ¥é”™ï¼Œç¦æ­¢äº¤äº’ã€‚
    * ğŸŸ¡ **é€‰ä¸­çŠ¶æ€ (Selected)**ï¼šèƒŒæ™¯è‰² `#f1c40f` (é»„è‰²)ã€‚ç”¨æˆ·ç‚¹å‡»åçš„é«˜äº®åé¦ˆã€‚

**2. äº¤äº’é€»è¾‘è®¾è®¡ (Interaction Logic)**

* **åœºæ™¯ Aï¼šå€Ÿé›¨å…·æ¨¡å¼ (Borrow Mode)**
    1.  **åˆå§‹åŒ–**ï¼šé¡µé¢åŠ è½½æ—¶ï¼Œéå†æœåŠ¡ç«¯è¿”å›çš„åº“å­˜åˆ—è¡¨ã€‚ä»…å°†çŠ¶æ€ä¸º **â€œå¯å€Ÿ (Available)â€** çš„æ§½ä½è®¾ä¸ºæ¿€æ´»ï¼ˆEnabledï¼‰ï¼Œå…¶ä½™æ§½ä½å˜ç°æˆ–é”å®šã€‚
    2.  **ç”¨æˆ·æ“ä½œ**ï¼š
        * ç”¨æˆ·ç‚¹å‡»æŸä¸ª **ç»¿è‰²æ§½ä½**ã€‚
        * å¼¹å‡º **â€œç¡®è®¤å€Ÿå‡ºâ€** æ¨¡æ€å¯¹è¯æ¡†ï¼Œæ˜¾ç¤ºè¯¥é›¨å…·çš„è¯¦ç»†å±æ€§ï¼ˆç±»å‹ã€æŠ¼é‡‘é‡‘é¢ï¼‰ã€‚
        * ç‚¹å‡»ç¡®è®¤åï¼Œå‘é€ `REQ:BORROW` æŒ‡ä»¤è‡³æœåŠ¡ç«¯ã€‚
    3.  **ç¡¬ä»¶æ¨¡æ‹Ÿåé¦ˆ**ï¼š
        * ç•Œé¢æ”¶åˆ°æœåŠ¡ç«¯ `RESP:SUCCESS` ä¿¡å·ã€‚
        * **åŠ¨ç”»æ•ˆæœ**ï¼šè¯¥æ§½ä½çš„é”æ‰£å›¾æ ‡ä»â€œğŸ”’â€å˜ä¸ºâ€œğŸ”“â€ï¼Œéšåå›¾æ ‡æ·¡å‡ºï¼ˆFade Outï¼‰ï¼ŒèƒŒæ™¯å˜ä¸ºç°è‰²ï¼ˆEmptyï¼‰ï¼Œæ¨¡æ‹Ÿé›¨å…·è¢«å–èµ°çš„è¿‡ç¨‹ã€‚

* **åœºæ™¯ Bï¼šè¿˜é›¨å…·æ¨¡å¼ (Return Mode)**
    1.  **åˆå§‹åŒ–**ï¼šé¡µé¢åŠ è½½æ—¶ï¼Œä»…é«˜äº®çŠ¶æ€ä¸º **â€œç©ºæ§½ (Empty)â€** çš„ç°è‰²æ§½ä½ã€‚
    2.  **ç”¨æˆ·æ“ä½œ**ï¼š
        * ç”¨æˆ·ç‚¹å‡»æŸä¸ª **ç°è‰²æ§½ä½**ï¼ˆæ¨¡æ‹Ÿç”¨æˆ·å°†ä¼æ’å…¥è¯¥å­”ï¼‰ã€‚
        * å¼¹å‡º **â€œæ­£åœ¨æ£€æµ‹...â€** è¿›åº¦æ¡çª—å£ï¼ˆæ¨¡æ‹Ÿ RFID èŠ¯ç‰‡è¯»å–è¿‡ç¨‹ï¼‰ã€‚
        * å»¶è¿Ÿ 1.5ç§’ åï¼Œæ˜¾ç¤º **â€œå½’è¿˜æˆåŠŸâ€**ã€‚
    3.  **ç¡¬ä»¶æ¨¡æ‹Ÿåé¦ˆ**ï¼š
        * è¯¥æ§½ä½èƒŒæ™¯ç¬é—´å˜ä¸ºç»¿è‰²ã€‚
        * ä¸­å¤®å›¾æ ‡æ ¹æ®å½’è¿˜çš„ç±»å‹ï¼ˆä¼æˆ–é›¨è¡£ï¼‰é‡æ–°å‡ºç°ã€‚

**3. OOP å¤šæ€åœ¨ UI ä¸Šçš„ä½“ç° (Technical Highlight)**
æœ¬æ¨¡å—åœ¨ View å±‚çš„æ¸²æŸ“é€»è¾‘ä¸­ï¼Œæ·±åº¦ç»“åˆäº† Model å±‚çš„å¤šæ€ç‰¹æ€§ã€‚

* **ä»£ç é€»è¾‘ç¤ºä¾‹**ï¼š
    `SlotItem` æ§ä»¶æ¥æ”¶ä¸€ä¸ªåŸºç±»æŒ‡é’ˆ `RainGear* item`ã€‚
    * è°ƒç”¨ `item->getIconPath()`ï¼šå¦‚æœæ˜¯ `Raincoat` å­ç±»ï¼Œè‡ªåŠ¨è¿”å›é›¨è¡£å›¾ç‰‡è·¯å¾„ã€‚
    * è°ƒç”¨ `item->getDeposit()`ï¼šå¦‚æœæ˜¯ `PremiumUmbrella` å­ç±»ï¼Œè‡ªåŠ¨æ˜¾ç¤ºâ€œæŠ¼é‡‘:50å…ƒâ€ã€‚
* **ä¼˜åŠ¿**ï¼šå½“æœªæ¥å¢åŠ â€œé®é˜³ä¼â€æ–°å“ç±»æ—¶ï¼Œæ— éœ€ä¿®æ”¹ UI ç»˜å›¾ä»£ç ï¼Œä»…éœ€æ–°å¢ä¸€ä¸ª C++ ç±»å³å¯ï¼Œå®Œç¾ç¬¦åˆ **å¼€é—­åŸåˆ™ (Open-Closed Principle)**ã€‚

#### 3.1.5 æ ¡å›­åœ°ç†ä¿¡æ¯å¯è§†åŒ–æ¨¡å— (Campus GIS Module)

æœ¬æ¨¡å—ä¸ºç³»ç»Ÿâ€œåˆ†å¸ƒå¼ç‰¹æ€§â€çš„ç›´è§‚å±•ç¤ºçª—å£ã€‚åŒºåˆ«äºä¼ ç»Ÿçš„åˆ—è¡¨å¼å±•ç¤ºï¼Œæœ¬ç•Œé¢é€šè¿‡åŠ è½½çœŸå®çš„ **NUIST æ ¡å›­å¹³é¢å›¾**ï¼Œåˆ©ç”¨åæ ‡æ˜ å°„æŠ€æœ¯åœ¨åœ°å›¾ä¸Šç»˜åˆ¶åŠ¨æ€æ•£ç‚¹ï¼ˆStationsï¼‰ï¼Œå®ç°â€œæ‰€è§å³æ‰€å¾—â€çš„åœ°ç†ä¿¡æ¯å¯¼èˆªã€‚

**1. è§†è§‰å‘ˆç°ç­–ç•¥ (Visual Strategy)**
* **åº•å›¾æ¸²æŸ“**ï¼š
    * ä½¿ç”¨ `QGraphicsView` æ¡†æ¶ä½œä¸ºåœ°å›¾å®¹å™¨ï¼ŒåŠ è½½é«˜åˆ†è¾¨ç‡çš„æ ¡å›­ä¿¯ç°å›¾ (`assets/map_nuist_hd.jpg`)ã€‚
    * å¯ç”¨ **æŠ—é”¯é½¿æ¸²æŸ“ (Antialiasing)**ï¼Œç¡®ä¿åœ°å›¾ç¼©æ”¾æ—¶çš„æ¸…æ™°åº¦ã€‚
* **æ•£ç‚¹å›¾å±‚ (Scatter Layer)**ï¼š
    * åœ¨åº•å›¾ä¹‹ä¸Šè¦†ç›–ä¸€ä¸ªé€æ˜çš„ **å¯¹è±¡å±‚**ï¼Œç”¨äºåŠ¨æ€ç”Ÿæˆä»£è¡¨å„ä¸ªå€Ÿè¿˜æ¡©çš„åœ†å½¢å›¾æ ‡ï¼ˆHotspotsï¼‰ã€‚
    * **Z-Order ç®¡ç†**ï¼šç¡®ä¿æ•£ç‚¹å›¾æ ‡å§‹ç»ˆä½äºåœ°å›¾èƒŒæ™¯ä¹‹ä¸Šï¼Œä¸”ä¸è¢«æ–‡å­—é®æŒ¡ã€‚

**2. æ ¸å¿ƒç®—æ³•ï¼šç›¸å¯¹åæ ‡æ˜ å°„ (Coordinate Mapping)**
ä¸ºäº†é€‚é…ä¸åŒåˆ†è¾¨ç‡çš„ç»ˆç«¯å±å¹•ï¼ŒæœåŠ¡ç«¯ä¸å­˜å‚¨ç»å¯¹åƒç´ åæ ‡ (x=500, y=300)ï¼Œè€Œæ˜¯å­˜å‚¨ **ç›¸å¯¹æ¯”ä¾‹åæ ‡ (Ratio Coordinates)**ã€‚
* **æœåŠ¡ç«¯æ•°æ®**ï¼šå­˜å‚¨ `pos_x = 0.5` (åœ°å›¾å®½åº¦çš„50%), `pos_y = 0.3` (åœ°å›¾é«˜åº¦çš„30%)ã€‚
* **å®¢æˆ·ç«¯æ¸²æŸ“é€»è¾‘**ï¼š
    ```cpp
    // ä¼ªä»£ç ç¤ºä¾‹ï¼šè®¡ç®—å±å¹•ä¸Šçš„å®é™…ç»˜åˆ¶åæ ‡
    int drawX = mapWidget->width() * station.posX;
    int drawY = mapWidget->height() * station.posY;
    hotspot->move(drawX, drawY);
    ```
* **ä¼˜åŠ¿**ï¼šæ— è®ºç»ˆç«¯å±å¹•æ˜¯ 1080P è¿˜æ˜¯ 720Pï¼Œæ•£ç‚¹å§‹ç»ˆç²¾ç¡®å¸é™„åœ¨æ•™å­¦æ¥¼æˆ–å®¿èˆæ¥¼çš„å¯¹åº”ä½ç½®ã€‚

**3. äº¤äº’æ§ä»¶è®¾è®¡ (Hotspot Widget)**
æ¯ä¸ªæ•£ç‚¹ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç”»å‡ºæ¥çš„åœ†ï¼Œè€Œæ˜¯ä¸€ä¸ªç»§æ‰¿è‡ª `QPushButton` çš„ç‹¬ç«‹å¯¹è±¡ã€‚
* **çŠ¶æ€å¤–è§‚ (StyleSheet)**ï¼š
    * **ğŸŸ¢ ç»¿è‰²å‘¼å¸ç¯æ•ˆæœ**ï¼ˆåˆ©ç”¨ `QPropertyAnimation` è°ƒèŠ‚é€æ˜åº¦ï¼‰ï¼šè¡¨ç¤º **æ¨èç«™ç‚¹**ï¼ˆåº“å­˜ > 5 ä¸” è·ç¦»è¾ƒè¿‘ï¼‰ã€‚
    * **ğŸŸ¡ é»„è‰²é™æ€åœ†ç‚¹**ï¼šè¡¨ç¤º **åº“å­˜ç´§å¼ **ï¼ˆåº“å­˜ < 2ï¼‰ã€‚
    * **âšªï¸ ç°è‰²åœ†ç‚¹**ï¼šè¡¨ç¤º **ç¦»çº¿/æ•…éšœ**ã€‚
* **ç‚¹å‡»äº¤äº’ (Click Event)**ï¼š
    * ç”¨æˆ·ç‚¹å‡»åœ°å›¾ä¸Šçš„ä»»æ„æ•£ç‚¹ã€‚
    * è§¦å‘ **Callout æ°”æ³¡å¼¹çª—**ï¼ˆç±»ä¼¼ç™¾åº¦åœ°å›¾çš„è¦†ç›–ç‰©ï¼‰ï¼Œæ˜¾ç¤ºè¯¥ç«™ç‚¹çš„è¯¦ç»†å¿«ç…§ï¼š
        * *ç«™ç‚¹åç§°*ï¼šâ€œä¸­è‹‘é£Ÿå ‚é—¨å£â€
        * *è·ç¦»å½“å‰*ï¼šâ€œçº¦ 500ç±³â€
        * *å®æ—¶åº“å­˜*ï¼šâ€œâ˜”ï¸ 10æŠŠ | ğŸ§¥ 5ä»¶â€

**4. è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ (Auto-Refresh)**
* è¯¥é¡µé¢å¼€å¯ä¸€ä¸ªç‹¬ç«‹çš„ `QTimer` å®šæ—¶å™¨ï¼ˆé—´éš” 30ç§’ï¼‰ã€‚
* åå°é™é»˜å‘æœåŠ¡ç«¯è¯·æ±‚æœ€æ–°çš„å…¨æ ¡åº“å­˜æ•°æ® (`REQ:GET_ALL_STATIONS`)ï¼Œå¹¶æ›´æ–°åœ°å›¾ä¸Šæ‰€æœ‰æ•£ç‚¹çš„é¢œè‰²çŠ¶æ€ï¼Œç¡®ä¿ç”¨æˆ·çœ‹åˆ°çš„æ•°æ®æ˜¯å®æ—¶çš„ã€‚



### 3.2 æœåŠ¡ç«¯ç®¡ç†åå°è§†å›¾è®¾è®¡ (Server-Side View Design)

æœåŠ¡ç«¯ç¨‹åºæ˜¯æ•´ä¸ªç³»ç»Ÿçš„â€œæ§åˆ¶å¡”â€ï¼Œé¢å‘ç³»ç»Ÿç®¡ç†å‘˜ä¸è¿ç»´äººå‘˜ã€‚ç•Œé¢è®¾è®¡å¼ºè°ƒ**é«˜å¯†åº¦ä¿¡æ¯å±•ç¤º**ä¸**å¤šä»»åŠ¡å¹¶è¡Œå¤„ç†èƒ½åŠ›**ã€‚é‡‡ç”¨ `QMainWindow` ä½œä¸ºä¸»æ¡†æ¶ï¼Œç»“åˆ `QDockWidget` æˆ–ä¾§è¾¹æ å¯¼èˆªå®ç°æ¨¡å—åŒ–ç®¡ç†ã€‚

#### 3.2.1 å…¨å±€ç›‘æ§ä»ªè¡¨ç›˜ (System Dashboard)
* **å¯¹åº”ç±»å**ï¼š`ServerMainWindow`
* **å¸ƒå±€ç­–ç•¥**ï¼šé‡‡ç”¨ç»å…¸çš„ **Admin Dashboard** å¸ƒå±€ã€‚
    * **å·¦ä¾§å¯¼èˆªæ **ï¼šå‚ç›´æ’åˆ—åŠŸèƒ½å›¾æ ‡ï¼ˆæ¦‚è§ˆã€è®¾å¤‡ã€ç”¨æˆ·ã€åº“å­˜ã€å®¢æœã€æ—¥å¿—ï¼‰ã€‚
    * **å³ä¾§ä¸»å·¥åŒº**ï¼šä½¿ç”¨ `QStackedWidget` åˆ‡æ¢ä¸åŒä¸šåŠ¡è§†å›¾ã€‚
    * **åº•éƒ¨çŠ¶æ€æ **ï¼šå®æ—¶æ˜¾ç¤ºæœåŠ¡å™¨ IPã€ç«¯å£ç›‘å¬çŠ¶æ€ã€å½“å‰å¹¶å‘è¿æ¥æ•°ï¼ˆå¦‚ï¼š`Online Clients: 12`ï¼‰ã€‚

**1. æ ¸å¿ƒæ¦‚è§ˆé¡µ (Overview Page)**
* **æ•°æ®å¡ç‰‡åŒº (Data Cards)**ï¼š
    * é¡¶éƒ¨æ¨ªå‘æ’åˆ—å››ä¸ªå½©è‰²å¡ç‰‡ï¼Œå±•ç¤ºæ ¸å¿ƒ KPIï¼š
    * ğŸ”µ **æ€»ç”¨æˆ·æ•°** (Total Users)
    * ğŸŸ¢ **åœ¨å€Ÿé›¨å…·** (Active Orders)
    * ğŸŸ¡ **åº“å­˜å‘Šæ€¥ç«™ç‚¹** (Low Stock Stations)
    * ğŸ”´ **ç¦»çº¿è®¾å¤‡å‘Šè­¦** (Offline Devices)
* **å®æ—¶æ—¥å¿—æµ (Live Log)**ï¼š
    * å±å¹•ä¸‹æ–¹è®¾ç½®ä¸€ä¸ª `QTextBrowser`ï¼Œå®æ—¶æ‰“å° Socket é€šä¿¡æ—¥å¿—ã€‚
    * *ç¤ºä¾‹*ï¼š`[14:00:01] Client #03 Connected (IP: 192.168.1.105)`

#### 3.2.2 è®¾å¤‡ä¸åº“å­˜ç®¡ç†æ¨¡å— (Device & Inventory)
æœ¬æ¨¡å—ç”¨äºè¿œç¨‹ç›‘æ§åˆ†å¸ƒåœ¨æ ¡å›­å„å¤„çš„ç»ˆç«¯çŠ¶æ€ã€‚

**1. åœ°å›¾ç›‘æ§è§†å›¾ (Map Monitor)**
* **å¤ç”¨æŠ€æœ¯**ï¼šå¤ç”¨å®¢æˆ·ç«¯çš„â€œåœ°å›¾å¯è§†åŒ–â€ç»„ä»¶ï¼Œä½†åœ¨åŠŸèƒ½ä¸Šè¿›è¡Œå¢å¼ºã€‚
* **ç®¡ç†å‘˜ç‰¹æƒ**ï¼š
    * åœ¨åœ°å›¾ä¸Šçš„æ•£ç‚¹æ—ï¼Œé¢å¤–æ˜¾ç¤ºè®¾å¤‡çš„ **IP åœ°å€** ã€‚
    * å³é”®ç‚¹å‡»ç«™ç‚¹ï¼Œå¯å¼¹å‡ºèœå•ï¼š**[è¿œç¨‹é‡å¯]**ã€**[å¼ºåˆ¶å¼€é”]**ï¼ˆç”¨äºå¤„ç†å¡ä½æ•…éšœï¼‰ã€‚

**2. åˆ—è¡¨è¯¦æƒ…è§†å›¾ (TableView)**
* **æ§ä»¶**ï¼š`QTableView` + `QSqlTableModel` (MVC æ¨¡å¼)ã€‚
* **åŠŸèƒ½**ï¼šä»¥è¡¨æ ¼å½¢å¼åˆ—å‡ºæ‰€æœ‰é›¨å…·ã€‚
* **å­—æ®µ**ï¼š`ID`, `ç±»å‹`, `æ‰€åœ¨ç«™ç‚¹`, `çŠ¶æ€`, `ç´¯è®¡å€Ÿå‡ºæ¬¡æ•°`ã€‚
* **äº¤äº’**ï¼šæ”¯æŒæŒ‰åˆ—æ’åºï¼ˆä¾‹å¦‚ï¼šç‚¹ä¸€ä¸‹â€œå€Ÿå‡ºæ¬¡æ•°â€ï¼Œæ‰¾å‡ºå“ªæŠŠä¼æœ€å—æ¬¢è¿ï¼‰ã€‚

#### 3.2.3 æ™ºèƒ½å®¢æœæ§åˆ¶å° (Support Chat Console)
è¿™æ˜¯é…åˆå®¢æˆ·ç«¯â€œè”ç³»å®¢æœâ€åŠŸèƒ½çš„åå°æ¥æ”¶ç«¯ï¼Œå®ç°äº† **ä¸€å¯¹å¤š** çš„å³æ—¶é€šè®¯ã€‚

* **å¸ƒå±€è®¾è®¡**ï¼šé‡‡ç”¨ç±»ä¼¼å¾®ä¿¡ PC ç‰ˆçš„ä¸‰æ å¸ƒå±€ã€‚
    * **å·¦æ  (User List)**ï¼š
        * ä½¿ç”¨ `QListWidget` æ˜¾ç¤ºå½“å‰å‘èµ·å’¨è¯¢çš„ç”¨æˆ·åˆ—è¡¨ã€‚
        * **æœªè¯»æé†’**ï¼šè‹¥æœ‰æ–°æ¶ˆæ¯ï¼Œç”¨æˆ·å¤´åƒå³ä¸Šè§’æ˜¾ç¤ºçº¢è‰²æ•°å­—è§’æ ‡ã€‚
    * **ä¸­æ  (Chat Window)**ï¼š
        * æ˜¾ç¤ºå½“å‰é€‰ä¸­ç”¨æˆ·çš„èŠå¤©è®°å½•ã€‚
        * æ”¯æŒç®¡ç†å‘˜å‘é€æ–‡æœ¬å›å¤ã€‚
    * **å³æ  (User Profile)**ï¼š
        * å½“é€‰ä¸­æŸä¸ªå’¨è¯¢è€…æ—¶ï¼Œè‡ªåŠ¨ä¾§æ»‘å±•ç¤ºè¯¥åŒå­¦çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå§“åã€å­¦å·ã€å½“å‰æ˜¯å¦æ­£åœ¨å€Ÿä¼ï¼‰ï¼Œæ–¹ä¾¿ç®¡ç†å‘˜å¿«é€ŸååŠ©ã€‚

**æŠ€æœ¯å®ç°äº®ç‚¹**ï¼š
* **å¤šçº¿ç¨‹æ¶ˆæ¯åˆ†å‘**ï¼šä¸»ç•Œé¢ä¸å¡é¡¿ï¼Œåå°çº¿ç¨‹è´Ÿè´£ç›‘å¬æ‰€æœ‰ Socket çš„ `readyRead` ä¿¡å·ï¼Œæ ¹æ® `msg_type == CHAT` å°†æ¶ˆæ¯è·¯ç”±åˆ°æ­¤æ¨¡å—ã€‚

#### 3.2.4 ç”¨æˆ·
* **ç”¨æˆ·ç®¡ç†**ï¼š
    * æä¾›æœç´¢æ¡†ï¼Œè¾“å…¥å­¦å·å¿«é€ŸæŸ¥è¯¢ç”¨æˆ·ä½™é¢ã€‚
    * **[å……å€¼/é€€æ¬¾] æŒ‰é’®**ï¼šç®¡ç†å‘˜å¯æ‰‹åŠ¨ä¿®æ”¹ç”¨æˆ·ä½™é¢ï¼ˆæ¨¡æ‹Ÿçº¿ä¸‹å……å€¼åœºæ™¯ï¼‰ã€‚



### 3.3 æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡ (Database Schema Design)

æœ¬ç³»ç»ŸæœåŠ¡ç«¯é‡‡ç”¨ **MySQL 8.0** å…³ç³»å‹æ•°æ®åº“ã€‚ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ä¸æ‰©å±•æ€§ï¼Œè®¾è®¡äº†ä»¥ä¸‹å››å¼ æ ¸å¿ƒæ•°æ®è¡¨ã€‚

> **å‘½åè§„èŒƒ**ï¼šè¡¨åç»Ÿä¸€ä»¥ `t_` å¼€å¤´ï¼Œä¸»é”®ä»¥ `_id` ç»“å°¾ã€‚

#### 1. ç”¨æˆ·ä¿¡æ¯è¡¨ (`t_user`)
å­˜å‚¨æ‰€æœ‰æ•™èŒå·¥ä¸å­¦ç”Ÿçš„è´¦æˆ·ä¿¡æ¯ã€‚
* **è®¾è®¡äº®ç‚¹**ï¼šé€šè¿‡ `role` å­—æ®µåŒºåˆ†èº«ä»½ï¼Œé¿å…åˆ›å»ºå¤šå¼ è¡¨ï¼Œç®€åŒ–æŸ¥è¯¢é€»è¾‘ã€‚

| å­—æ®µå      | ç±»å‹             | çº¦æŸ             | æè¿°                                  |
| :---------- | :--------------- | :--------------- | :------------------------------------ |
| `user_id`   | `VARCHAR(20)`    | **PK**, Not Null | **å­¦å·/å·¥å·** (å¦‚ "20231345")         |
| `password`  | `VARCHAR(64)`    | Not Null         | ç™»å½•å¯†ç  (å­˜å‚¨ SHA256 å¯†æ–‡)           |
| `real_name` | `VARCHAR(20)`    | Not Null         | çœŸå®å§“å (å¦‚ "å¼ ä¸‰")                  |
| `role`      | `INT`            | Not Null         | è§’è‰²æ ‡è¯† (0:å­¦ç”Ÿ, 1:æ•™èŒå·¥, 9:ç®¡ç†å‘˜) |
| `balance`   | `DECIMAL(10, 2)` | Default 0.00     | è´¦æˆ·ä½™é¢ (å•ä½: å…ƒ)                   |
| `avatar_id` | `INT`            | Default 1        | å¤´åƒèµ„æºç´¢å¼• ID                       |

#### 2. ç«™ç‚¹/ç»ˆç«¯è¡¨ (`t_station`)
å­˜å‚¨åˆ†å¸ƒåœ¨æ ¡å›­å„å¤„çš„è‡ªåŠ©æœºç»ˆç«¯ä¿¡æ¯ï¼ˆå¯¹åº”åœ°å›¾ä¸Šçš„æ•£ç‚¹ï¼‰ã€‚

| å­—æ®µå       | ç±»å‹          | çº¦æŸ             | æè¿°                          |
| :----------- | :------------ | :--------------- | :---------------------------- |
| `station_id` | `INT`         | **PK**, Auto Inc | ç«™ç‚¹ç¼–å· (1, 2, 3...)         |
| `name`       | `VARCHAR(50)` | Not Null         | ç«™ç‚¹åç§° (å¦‚ "æ–‡å¾·æ¥¼è¥¿é—¨")    |
| `pos_x`      | `FLOAT`       | Not Null         | åœ°å›¾ç›¸å¯¹åæ ‡ X (0.0 - 1.0)    |
| `pos_y`      | `FLOAT`       | Not Null         | åœ°å›¾ç›¸å¯¹åæ ‡ Y (0.0 - 1.0)    |
| `status`     | `INT`         | Default 1        | çŠ¶æ€ (1:åœ¨çº¿, 0:ç¦»çº¿, 2:æ•…éšœ) |

#### 3. é›¨å…·åº“å­˜è¡¨ (`t_rain_gear`)
å­˜å‚¨æ¯ä¸€æŠŠé›¨ä¼æˆ–é›¨è¡£çš„ä¸ªä½“çŠ¶æ€ã€‚è¿™æ˜¯ **OOP å¤šæ€** åœ¨æ•°æ®åº“å±‚é¢çš„ä½“ç°ã€‚

| å­—æ®µå       | ç±»å‹          | çº¦æŸ            | æè¿°                                  |
| :----------- | :------------ | :-------------- | :------------------------------------ |
| `gear_id`    | `VARCHAR(20)` | **PK**          | é›¨å…·å”¯ä¸€ç¼–ç  (RFID èŠ¯ç‰‡å·)            |
| `type_id`    | `INT`         | Not Null        | **ç§ç±»** (1:æ™®é€šä¼, 2:æŠ—é£ä¼, 3:é›¨è¡£) |
| `station_id` | `INT`         | FK -> t_station | å½“å‰æ‰€åœ¨çš„ç«™ç‚¹ ID (è‹¥å€Ÿå‡ºåˆ™ä¸º NULL)   |
| `slot_id`    | `INT`         | Nullable        | å½“å‰æ‰€åœ¨çš„å¡æ§½ç¼–å· (1-12)             |
| `status`     | `INT`         | Default 1       | çŠ¶æ€ (1:å¯å€Ÿ, 2:å·²å€Ÿå‡º, 3:æŸå)       |

#### 4. å€Ÿè¿˜è®°å½•è¡¨ (`t_record`)
ç³»ç»Ÿçš„è´¦æœ¬ï¼Œè®°å½•æ¯ä¸€ç¬”æµæ°´ã€‚

| å­—æ®µå        | ç±»å‹            | çº¦æŸ             | æè¿°                     |
| :------------ | :-------------- | :--------------- | :----------------------- |
| `record_id`   | `BIGINT`        | **PK**, Auto Inc | æµæ°´å·                   |
| `user_id`     | `VARCHAR(20)`   | FK -> t_user     | å€Ÿç”¨äºº                   |
| `gear_id`     | `VARCHAR(20)`   | FK -> t_gear     | å€Ÿç”¨çš„ç‰©å“               |
| `borrow_time` | `DATETIME`      | Not Null         | å€Ÿå‡ºæ—¶é—´                 |
| `return_time` | `DATETIME`      | Nullable         | å½’è¿˜æ—¶é—´ (æœªè¿˜åˆ™ä¸º NULL) |
| `cost`        | `DECIMAL(10,2)` | Default 0.00     | äº§ç”Ÿçš„è´¹ç”¨               |

---



### 3.4 æ¨¡å‹å±‚ä¸ç±»ç»“æ„è®¾è®¡ (Model & Class Design)

æœ¬ç« èŠ‚é˜è¿° C++ æ ¸å¿ƒç±»çš„è®¾è®¡ã€‚ä¸ºäº†ä¿è¯ä»£ç çš„ç¨³å®šæ€§å’Œè·¨å¹³å°å…¼å®¹æ€§ï¼ˆé¿å…ä¸­æ–‡ä¹±ç ï¼‰ï¼Œæˆ‘ä»¬åœ¨**ä»£ç é€»è¾‘ä¸­ç»Ÿä¸€ä½¿ç”¨è‹±æ–‡æ ‡è¯†ç¬¦**ï¼ŒåŒæ—¶å¼•å…¥ä¸€ä¸ª**è¾…åŠ©å·¥å…·ç±»**æ¥è´Ÿè´£å°†è‹±æ–‡æ˜ å°„ä¸ºä¸­æ–‡æ˜¾ç¤ºã€‚

#### 3.4.1 å…¨å±€æšä¸¾å®šä¹‰ (Global Enums)

åœ¨å¤´æ–‡ä»¶ `GlobalDefs.h` ä¸­å®šä¹‰ã€‚è¿™äº›æšä¸¾æ˜¯ç¨‹åºé€»è¾‘çš„â€œéª¨æ¶â€ã€‚

C++

```
#include <QObject> // ä¸ºäº†ä½¿ç”¨ Q_ENUM ç­‰ç‰¹æ€§

// 1. é›¨å…·ç±»å‹æšä¸¾ (å¯¹åº”æ•°æ®åº“ t_rain_gear.type_id)
enum class GearType {
    Unknown = 0,
    StandardPlastic = 1,    // æ™®é€šå¡‘æ–™ä¼
    PremiumWindproof = 2,   // é«˜è´¨é‡æŠ—é£ä¼
    Sunshade = 3,           // ä¸“ç”¨é®é˜³ä¼
    Raincoat = 4            // é›¨è¡£
};

// 2. ç«™ç‚¹æšä¸¾ (ä»£ç ä¸­ä½¿ç”¨è¿™äº›è‹±æ–‡åï¼Œé¿å…ä¹±ç )
enum class StationCode {
    Wende,      // æ–‡å¾·æ¥¼
    Mingde,     // æ˜å¾·æ¥¼
    Library,    // å›¾ä¹¦é¦†
    Changwang,  // é•¿æœ›æ¥¼
    Oufang,     // è—•èˆ«æ¥¼
    Beichen,    // åŒ—è¾°æ¥¼
    Dorm1,      // è¥¿è‹‘ä¸€å·ç«™
    Gym,        // ä½“è‚²é¦†
    Admin       // è¡Œæ”¿æ¥¼
};
```

#### 3.4.2 è¾…åŠ©å·¥å…·ç±»ï¼šä¸­æ–‡æ˜ å°„ (StationUtils)

è¿™æ˜¯ä¸€ä¸ªé™æ€å·¥å…·ç±»ï¼Œå……å½“â€œç¿»è¯‘å®˜â€çš„è§’è‰²ã€‚å®ƒè´Ÿè´£æŠŠä¸Šé¢çš„è‹±æ–‡æšä¸¾ç¿»è¯‘æˆä¸­æ–‡ï¼Œä¾›ç•Œé¢ (UI) æ˜¾ç¤ºä½¿ç”¨ã€‚

C++

```
#include <QString>
#include "GlobalDefs.h"

class StationUtils {
public:
    // [æ ¸å¿ƒåŠŸèƒ½] è¾“å…¥è‹±æ–‡æšä¸¾ï¼Œè¿”å›ä¸­æ–‡åç§°
    static QString getChineseName(StationCode code) {
        switch (code) {
            case StationCode::Wende:     return "æ–‡å¾·æ¥¼";
            case StationCode::Mingde:    return "æ˜å¾·æ¥¼";
            case StationCode::Library:   return "å›¾ä¹¦é¦†";
            case StationCode::Changwang: return "é•¿æœ›æ¥¼";
            case StationCode::Oufang:    return "è—•èˆ«æ¥¼";
            case StationCode::Beichen:   return "åŒ—è¾°æ¥¼";
            case StationCode::Dorm1:     return "è¥¿è‹‘ä¸€å·ç«™";
            case StationCode::Gym:       return "ä½“è‚²é¦†";
            case StationCode::Admin:     return "è¡Œæ”¿æ¥¼";
            default:                     return "æœªçŸ¥ç«™ç‚¹";
        }
    }
    
    // [æ ¸å¿ƒåŠŸèƒ½] è¾“å…¥è‹±æ–‡æšä¸¾ï¼Œè¿”å›ç«™ç‚¹æè¿° (å¯é€‰)
    static QString getDescription(StationCode code) {
        if (code == StationCode::Library) return "å­¦ä¹ æ°›å›´æµ“åšï¼Œé›¨ä¼éœ€æ±‚é‡å¤§";
        if (code == StationCode::Gym)     return "è¿åŠ¨ç»“æŸåå¸¸æœ‰å€Ÿä¼éœ€æ±‚";
        return "æ™®é€šæ•™å­¦ä¸åŠå…¬åŒºåŸŸ";
    }
};
```

#### 3.4.3 é›¨å…·ç±»æ—è®¾è®¡ (RainGear Family)

åˆ©ç”¨ç»§æ‰¿å’Œå¤šæ€ï¼Œç®¡ç†ä¸åŒç§ç±»çš„é›¨å…·ã€‚

**1. é›¨å…·åŸºç±» (RainGear) - æŠ½è±¡ç±»**

C++

```
class RainGear {
protected:
    QString m_id;         // å”¯ä¸€ç¼–å· (RFID)
    GearType m_type;      // ç±»å‹
    int m_stationId;      // æ‰€åœ¨ç«™ç‚¹ ID
    int m_status;         // çŠ¶æ€ (1:å¯å€Ÿ, 2:å€Ÿå‡º, 3:æŸå)

public:
    RainGear(QString id, GearType type) : m_id(id), m_type(type) {}
    virtual ~RainGear() {}

    // [å¤šæ€æ ¸å¿ƒ] çº¯è™šå‡½æ•°ï¼šä¸åŒå­ç±»è®¡ç®—æŠ¼é‡‘çš„æ–¹å¼ä¸åŒ
    virtual double getDeposit() const = 0; 
    
    // [å¤šæ€æ ¸å¿ƒ] çº¯è™šå‡½æ•°ï¼šè·å–å›¾æ ‡èµ„æºè·¯å¾„
    virtual QString getIconPath() const = 0;

    QString getId() const { return m_id; }
    GearType getType() const { return m_type; }
};
```

**2. å…·ä½“å­ç±»å®ç°**

C++

```
// 1. æ™®é€šå¡‘æ–™ä¼
class StandardPlasticUmbrella : public RainGear {
public:
    StandardPlasticUmbrella(QString id) : RainGear(id, GearType::StandardPlastic) {}
    double getDeposit() const override { return 20.00; }
    QString getIconPath() const override { return ":/icons/umbrella_plastic.png"; }
};

// 2. é«˜è´¨é‡æŠ—é£ä¼
class PremiumWindproofUmbrella : public RainGear {
public:
    PremiumWindproofUmbrella(QString id) : RainGear(id, GearType::PremiumWindproof) {}
    double getDeposit() const override { return 50.00; }
    QString getIconPath() const override { return ":/icons/umbrella_windproof.png"; }
};

// 3. ä¸“ç”¨é®é˜³ä¼
class SunshadeUmbrella : public RainGear {
public:
    SunshadeUmbrella(QString id) : RainGear(id, GearType::Sunshade) {}
    double getDeposit() const override { return 30.00; }
    QString getIconPath() const override { return ":/icons/umbrella_sun.png"; }
};

// 4. é›¨è¡£
class Raincoat : public RainGear {
public:
    Raincoat(QString id) : RainGear(id, GearType::Raincoat) {}
    double getDeposit() const override { return 15.00; }
    QString getIconPath() const override { return ":/icons/raincoat.png"; }
};
```

#### 3.4.4 åœ°ç‚¹ä¸åº“å­˜ç±» (Station)

è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨äº† `StationUtils` æ¥è‡ªåŠ¨è®¾ç½®ä¸­æ–‡åã€‚

C++

```
class Station {
private:
    StationCode m_code; // ä½¿ç”¨æšä¸¾æ ‡è¯†ç«™ç‚¹
    QString m_name;     // ä¸­æ–‡åç§° (è‡ªåŠ¨ç”Ÿæˆ)
    double m_posX;      // åœ°å›¾ X åæ ‡
    double m_posY;      // åœ°å›¾ Y åæ ‡
    QList<RainGear*> m_inventory; // åº“å­˜åˆ—è¡¨

public:
    // æ„é€ å‡½æ•°ï¼šåªéœ€è¦ä¼ å…¥æšä¸¾ Codeï¼Œä¸­æ–‡åè‡ªåŠ¨è·å–ï¼
    Station(StationCode code, double x, double y)
        : m_code(code), m_posX(x), m_posY(y) 
    {
        // è‡ªåŠ¨è°ƒç”¨å·¥å…·ç±»è·å–ä¸­æ–‡åï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥å­—ç¬¦ä¸²
        m_name = StationUtils::getChineseName(code);
    }

    // è·å–åº“å­˜æ•°é‡
    int getAvailableCount() const { return m_inventory.size(); }
    
    // è·å–ä¸­æ–‡å (ç”¨äºç•Œé¢æ˜¾ç¤º)
    QString getName() const { return m_name; }

    // å€Ÿè¿˜é€»è¾‘
    RainGear* takeGear(QString gearId) { /* ... éå†æŸ¥æ‰¾é€»è¾‘ ... */ return nullptr; }
    void returnGear(RainGear* gear) { if(gear) m_inventory.append(gear); }
};
```

#### 3.4.5 ç”¨æˆ·ç±» (User)

C++

```
class User {
private:
    QString m_uid;      // å­¦å·
    QString m_name;     // å§“å
    double m_balance;   // ä½™é¢
    int m_role;         // 0:å­¦ç”Ÿ, 1:è€å¸ˆ

public:
    User(QString uid, QString name, double balance, int role)
        : m_uid(uid), m_name(name), m_balance(balance), m_role(role) {}

    bool canBorrow() const { return m_balance >= 20.0; }
    
    bool deductBalance(double amount) {
        if (m_balance >= amount) {
            m_balance -= amount;
            return true;
        }
        return false;
    }
};
```

#### 3.4.6 å·¥å‚æ¨¡å¼ (RainGearFactory)

è´Ÿè´£æ ¹æ®æ•°æ®åº“é‡Œçš„ç±»å‹ï¼Œç”Ÿäº§å¯¹åº”çš„ C++ å¯¹è±¡ã€‚å®é™…é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè€ƒè™‘ä½¿ç”¨æ ‡å‡†åº“çš„æ™ºèƒ½æŒ‡é’ˆã€‚

C++

```
class RainGearFactory {
public:
    static RainGear* createGear(QString id, GearType type) {
        switch (type) {
            case GearType::StandardPlastic: return new StandardPlasticUmbrella(id);
            case GearType::PremiumWindproof: return new PremiumWindproofUmbrella(id);
            case GearType::Sunshade:        return new SunshadeUmbrella(id);
            case GearType::Raincoat:        return new Raincoat(id);
            default:                        return nullptr;
        }
    }
};
```





## 4. æ§åˆ¶å±‚æ¶æ„è®¾è®¡ (Controller Layer Architecture)

æ§åˆ¶å±‚ï¼ˆControllerï¼‰æ˜¯ç³»ç»Ÿçš„â€œä¸­æ¢ç¥ç»â€ï¼Œè¿æ¥è§†å›¾å±‚ï¼ˆViewï¼‰ä¸æ•°æ®å±‚ï¼ˆModelï¼‰ã€‚ä¸ºäº†ç¡®ä¿ç³»ç»Ÿçš„é«˜å¹¶å‘ç¨³å®šæ€§ï¼ˆç‰¹åˆ«æ˜¯å¤šç»ˆç«¯åŒæ—¶æ“ä½œæ—¶ï¼‰ï¼Œæœ¬å±‚è®¾è®¡éµå¾ª **å•ä¸€èŒè´£åŸåˆ™ (SRP)**ï¼Œå¹¶åœ¨ C++ ä¸ MySQL æ•°æ®åº“ä¹‹é—´å»ºç«‹äº†ä¸¥æ ¼çš„**çº¿ç¨‹å®‰å…¨**åˆ†å±‚ã€‚

### 4.1 åŸºç¡€è®¾æ–½å±‚ï¼šæ•°æ®åº“è¿æ¥åŠ©æ‰‹ (DBHelper)

åœ¨å¤šçº¿ç¨‹ç¯å¢ƒï¼ˆå¦‚ Socket æœåŠ¡ç«¯ï¼‰ä¸‹ï¼ŒQt ç¦æ­¢åœ¨ä¸åŒçº¿ç¨‹é—´å…±äº«åŒä¸€ä¸ª `QSqlDatabase` è¿æ¥å¯¹è±¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬**ä¸èƒ½**ä½¿ç”¨ä¼ ç»Ÿçš„å•ä¾‹æ¨¡å¼å¤ç”¨è¿æ¥ï¼Œè€Œå¿…é¡»é‡‡ç”¨ **â€œçº¿ç¨‹å±€éƒ¨è¿æ¥æ± â€** ç­–ç•¥ã€‚

**DBHelper.h (é‡æ„ç‰ˆ - çº¿ç¨‹å®‰å…¨)**

C++

```cpp
#include <QSqlDatabase>
#include <QSqlError>
#include <QDebug>
#include <QThread>
#include <QUuid>

class DBHelper {
public:
    /**
     * @brief [æ ¸å¿ƒ] è·å–å½“å‰çº¿ç¨‹çš„ä¸“å±æ•°æ®åº“è¿æ¥
     * ç­–ç•¥ï¼šä»¥å½“å‰çº¿ç¨‹ ID ä¸ºåç¼€å‘½åè¿æ¥ï¼Œç¡®ä¿æ¯ä¸ªçº¿ç¨‹ç‹¬äº«ä¸€ä¸ªè¿æ¥å¯¹è±¡
     */
    static QSqlDatabase getThreadLocalConnection() {
        // 1. æ„é€ å”¯ä¸€çš„è¿æ¥åç§° (å¦‚: "Conn_0x7f8a1234")
        QString connectionName = QString("Conn_%1").arg((quint64)QThread::currentThreadId());

        // 2. å¦‚æœè¯¥è¿æ¥å·²å­˜åœ¨ï¼Œç›´æ¥è¿”å›ï¼ˆå¤ç”¨ï¼‰
        if (QSqlDatabase::contains(connectionName)) {
            return QSqlDatabase::database(connectionName);
        }

        // 3. å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°è¿æ¥
        QSqlDatabase db = QSqlDatabase::addDatabase("QMYSQL", connectionName);
        db.setHostName("127.0.0.1");
        db.setPort(3306);
        db.setDatabaseName("rain_gear_db");
        db.setUserName("root");
        db.setPassword("123456"); // å»ºè®®åæœŸç§»å…¥é…ç½®æ–‡ä»¶

        if (!db.open()) {
            qCritical() << "Thread DB Connect Error:" << db.lastError().text();
        } else {
            qDebug() << "New DB Connection created for thread:" << QThread::currentThreadId();
        }
        return db;
    }

    /**
     * @brief [æ¸…ç†] çº¿ç¨‹ç»“æŸæ—¶å¿…é¡»è°ƒç”¨ï¼Œé‡Šæ”¾èµ„æº
     */
    static void removeThreadConnection() {
        QString connectionName = QString("Conn_%1").arg((quint64)QThread::currentThreadId());
        QSqlDatabase::removeDatabase(connectionName);
    }

private:
    DBHelper() {} // ç¦æ­¢å®ä¾‹åŒ–
};
```

### 4.2 æ•°æ®è®¿é—®å±‚ (DAO Layer)

DAO å±‚æ˜¯ä¸šåŠ¡å±‚ä¸æ•°æ®åº“ä¹‹é—´çš„â€œç¿»è¯‘å®˜â€ã€‚å®ƒåªè´Ÿè´£æ‰§è¡Œ SQLï¼Œä¸å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚**å…³é”®ä¿®æ­£**ï¼šæ‰§è¡Œ SQL æ—¶ï¼Œå¿…é¡»æ˜¾å¼æŒ‡å®šä½¿ç”¨å½“å‰çº¿ç¨‹çš„æ•°æ®åº“è¿æ¥ã€‚

#### 4.2.1 RainGearDAO (é›¨å…·æ•°æ®è®¿é—®)

C++

```cpp
// RainGearDAO.h
#include "GlobalDefs.h"
#include "RainGear.h"
#include "RainGearFactory.h"
#include "DBHelper.h" // å¼•å…¥æ–°çš„åŠ©æ‰‹
#include <QSqlQuery>
#include <QVariant>

class RainGearDAO {
public:
    static RainGear* getGearById(QString id) {
        // ã€å…³é”®ã€‘è·å–å½“å‰çº¿ç¨‹çš„è¿æ¥ï¼Œå¹¶ä¼ ç»™ QSqlQuery
        QSqlDatabase db = DBHelper::getThreadLocalConnection();
        QSqlQuery query(db); 
        
        query.prepare("SELECT type_id, station_id, status FROM t_rain_gear WHERE gear_id = :id");
        query.bindValue(":id", id);

        if (query.exec() && query.next()) {
            int typeVal = query.value("type_id").toInt();
            // ... (å·¥å‚åˆ›å»ºé€»è¾‘ä¿æŒä¸å˜)
            RainGear* gear = RainGearFactory::createGear(id, static_cast<GearType>(typeVal));
            return gear;
        }
        return nullptr;
    }

    static bool updateGearStatus(QString id, int newStatus, int newStationId) {
        QSqlDatabase db = DBHelper::getThreadLocalConnection();
        QSqlQuery query(db); // ç»‘å®šè¿æ¥

        query.prepare("UPDATE t_rain_gear SET status = :st, station_id = :sid WHERE gear_id = :id");
        query.bindValue(":st", newStatus);
        query.bindValue(":sid", newStationId);
        query.bindValue(":id", id);
        
        return query.exec();
    }
};
```

#### 4.2.2 RecordDAO (å€Ÿè¿˜è®°å½•)

C++

```cpp
// RecordDAO.h
class RecordDAO {
public:
    static bool addBorrowRecord(QString userId, QString gearId, int stationId) {
        QSqlDatabase db = DBHelper::getThreadLocalConnection();
        QSqlQuery query(db); // ç»‘å®šè¿æ¥

        query.prepare("INSERT INTO t_record (user_id, gear_id, borrow_station_id, borrow_time, status) "
                      "VALUES (:uid, :gid, :sid, NOW(), 0)");
        query.bindValue(":uid", userId);
        query.bindValue(":gid", gearId);
        query.bindValue(":sid", stationId);
        return query.exec();
    }
};
```

### 4.3 ä¸šåŠ¡é€»è¾‘å±‚ (Service Layer)

è¿™æ˜¯ç³»ç»Ÿçš„â€œå¤§è„‘â€ã€‚ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼ˆä¾‹å¦‚ï¼šæ‰£äº†é’±å¿…é¡»å¼¹å‡ºä¼ï¼‰ï¼Œæœ¬å±‚å¿…é¡»å¼•å…¥ **æ•°æ®åº“äº‹åŠ¡ (Transaction)** æ§åˆ¶ã€‚

**SystemManager.h (é‡æ„ç‰ˆ - äº‹åŠ¡æ§åˆ¶)**

C++

```cpp
#include "User.h"
#include "RainGearDAO.h"
#include "RecordDAO.h"
#include "UserDAO.h"
#include "DBHelper.h"

class SystemManager {
public:
    enum class Result { Success, GearNotFound, UserBalanceLow, DbError };

    /**
     * @brief æ ¸å¿ƒä¸šåŠ¡ï¼šå€Ÿä¼æµç¨‹ (åŸå­æ€§äº‹åŠ¡)
     */
    static Result borrowGear(QString userId, QString gearId) {
        // 1. è·å–è¿æ¥å¹¶å¼€å¯äº‹åŠ¡
        QSqlDatabase db = DBHelper::getThreadLocalConnection();
        if (!db.transaction()) {
            return Result::DbError; // æ— æ³•å¼€å¯äº‹åŠ¡
        }

        bool transactionSuccess = false;
        Result finalResult = Result::DbError;

        try {
            // Step 1: æ£€æŸ¥å¹¶æ‰£é™¤ä½™é¢
            User* user = UserDAO::getUser(userId);
            if (!user || user->getBalance() < 20.0) {
                delete user;
                throw Result::UserBalanceLow; // æŠ›å‡ºå¼‚å¸¸ä¸­æ–­
            }
            // TODO: è¿™é‡Œåº”è°ƒç”¨ UserDAO::updateBalance(userId, -20.0);
            
            // Step 2: æ£€æŸ¥å¹¶é”å®šé›¨å…·
            RainGear* gear = RainGearDAO::getGearById(gearId);
            if (!gear) {
                delete user;
                throw Result::GearNotFound;
            }

            // Step 3: æ›´æ–°æ•°æ®åº“çŠ¶æ€ (åŸå­æ“ä½œæ ¸å¿ƒ)
            // æ­¤æ—¶æ‰€æœ‰æ“ä½œè™½ç„¶æ‰§è¡Œäº†ï¼Œä½†æœªæäº¤(Commit)å‰ï¼Œå¯¹å¤–ç•Œä¸å¯è§
            bool updateOk = RainGearDAO::updateGearStatus(gearId, 2, 0);
            bool recordOk = RecordDAO::addBorrowRecord(userId, gearId, 1);

            // Step 4: å†³å®šæäº¤è¿˜æ˜¯å›æ»š
            if (updateOk && recordOk) {
                db.commit(); // ã€æäº¤ã€‘æ‰€æœ‰æ”¹å˜æ°¸ä¹…ç”Ÿæ•ˆ
                transactionSuccess = true;
                finalResult = Result::Success;
            } else {
                db.rollback(); // ã€å›æ»šã€‘æ’¤é”€ä¸Šè¿°æ‰€æœ‰ SQL æ“ä½œ
                transactionSuccess = false;
                finalResult = Result::DbError;
            }

            delete user;
            delete gear;

        } catch (Result error) {
            db.rollback(); // æ•è·åˆ°ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼ˆå¦‚ä½™é¢ä¸è¶³ï¼‰ï¼Œç«‹å³å›æ»š
            finalResult = error;
        }

        return finalResult;
    }
};
```

### 4.4 æ¶æ„ç±»å…³ç³»å›¾ (UML Class Architecture)

ä¸ºäº†ç›´è§‚å±•ç¤ºæ¶æ„å…³ç³»åŠä¾èµ–é“¾æ¡ï¼Œå®šä¹‰å¦‚ä¸‹å±‚çº§ï¼š

ä»£ç æ®µ

```cpp
classDiagram
    class SystemManager {
        <<Service>>
        +borrowGear(uid, gearId)
        -checkBalance(user)
    }

    class DBHelper {
        <<Infrastructure>>
        +getThreadLocalConnection() : QSqlDatabase
        +removeThreadConnection()
    }

    class RainGearDAO {
        <<DAO>>
        +getGearById()
        +updateGearStatus()
    }

    class UserDAO {
        <<DAO>>
        +getUser()
    }

    %% å…³ç³»æè¿°
    SystemManager ..> RainGearDAO : è°ƒåº¦
    SystemManager ..> UserDAO : è°ƒåº¦
    SystemManager ..> DBHelper : è·å–äº‹åŠ¡æ§åˆ¶æƒ
    RainGearDAO ..> DBHelper : è·å–è¿æ¥æ‰§è¡ŒSQL
    UserDAO ..> DBHelper : è·å–è¿æ¥æ‰§è¡ŒSQL
```





## 5. ç½‘ç»œé€šä¿¡åè®®è®¾è®¡ (Network Protocol Design)

æœ¬ç« èŠ‚å®šä¹‰å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯äº¤äº’çš„â€œè¯­è¨€â€ã€‚ä¸ºäº†ç¡®ä¿ Qt å¼€å‘çš„ä¾¿åˆ©æ€§ä¸æ•°æ®è§£æçš„é«˜æ•ˆæ€§ï¼Œç³»ç»Ÿç»Ÿä¸€é‡‡ç”¨ **TCP é•¿è¿æ¥** + **JSON æ•°æ®åŒ…** çš„å½¢å¼ã€‚

### 5.1 é€šä¿¡åŸºç¡€è§„çº¦ (Basic Protocol)

* **ä¼ è¾“å±‚åè®®**ï¼šTCP/IP
* **ç¼–ç æ ¼å¼**ï¼šUTF-8
* **æ•°æ®å¤„ç†å»ºè®®**ï¼šå»ºè®®ä½¿ç”¨ Qt çš„ `QDataStream` ç±»è¿›è¡Œæ•°æ®çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼Œå®ƒé»˜è®¤é‡‡ç”¨ **Big-Endian (ç½‘ç»œå­—èŠ‚åº)**ï¼Œå¯è‡ªåŠ¨å±è”½ä¸åŒç¡¬ä»¶å¹³å°ä¹‹é—´çš„å¤§å°ç«¯å·®å¼‚ï¼Œç®€åŒ–å¼€å‘ã€‚
* **å°åŒ…ç»“æ„**ï¼šä¸ºäº†è§£å†³ TCP ç²˜åŒ…/æ‹†åŒ…é—®é¢˜ï¼Œé‡‡ç”¨ **Header + Body** ç»“æ„ã€‚
    * **Header (4å­—èŠ‚)**ï¼š`quint32` ç±»å‹ï¼Œå­˜å‚¨åç»­ JSON æ•°æ®çš„å­—èŠ‚é•¿åº¦ã€‚
    * **Body (å˜é•¿)**ï¼šæ ‡å‡†çš„ JSON å­—ç¬¦ä¸²æ•°æ®ã€‚

### 5.2 JSON åŒ…ä½“é€šç”¨ç»“æ„

æ‰€æœ‰æ•°æ®åŒ…ï¼ˆRequest å’Œ Responseï¼‰çš„æ ¹å¯¹è±¡å¿…é¡»åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªå­—æ®µï¼š

```json
{
    "msg_type": "REQ_LOGIN",    // ã€å…³é”®ã€‘æ¶ˆæ¯ç±»å‹ï¼Œç”¨äº switch-case åˆ†å‘
    "timestamp": 1701934000,    // Unix æ—¶é—´æˆ³ï¼Œç”¨äºæ—¥å¿—è®°å½•
    "data": { ... }             // ä¸šåŠ¡æ•°æ®è½½è·ï¼Œæ ¹æ® msg_type å˜åŒ–
}
```

### 5.3 æ ¸å¿ƒæŒ‡ä»¤é›† (Command Set)

è¯·åœ¨ä»£ç çš„ `GlobalDefs.h` ä¸­å®šä¹‰å¯¹åº”çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œç¡®ä¿å‰åç«¯ä¸€è‡´ã€‚

| **æ¶ˆæ¯ç±»å‹ (msg_type)** | **å‘èµ·æ–¹** | **è¯´æ˜**         | **å¯¹åº”ä¸šåŠ¡**    |
| ----------------------- | ---------- | ---------------- | --------------- |
| `REQ_LOGIN`             | Client     | ç™»å½•è¯·æ±‚         | èº«ä»½éªŒè¯        |
| `RESP_LOGIN`            | Server     | ç™»å½•ç»“æœ         |                 |
| `REQ_MAP_DATA`          | Client     | è¯·æ±‚å…¨æ ¡ç«™ç‚¹æ•°æ® | åœ°å›¾ç›‘æ§/åˆå§‹åŒ– |
| `RESP_MAP_DATA`         | Server     | è¿”å›ç«™ç‚¹åŠåº“å­˜   |                 |
| `REQ_BORROW`            | Client     | è¯·æ±‚å€Ÿé›¨å…·       | å€Ÿè¿˜ä¸šåŠ¡        |
| `RESP_BORROW`           | Server     | å€Ÿå‡ºç»“æœ(å¼€é”)   |                 |
| `REQ_RETURN`            | Client     | è¯·æ±‚å½’è¿˜         | å€Ÿè¿˜ä¸šåŠ¡        |
| `RESP_RETURN`           | Server     | å½’è¿˜ç»“æœ(ç»“ç®—)   |                 |
| `PUSH_CHAT`             | Both       | å®¢æœæ¶ˆæ¯æ¨é€     | æ™ºèƒ½å®¢æœ        |

### 5.4 è¯¦ç»†æŠ¥æ–‡å®šä¹‰ (Payload Detail)

#### 5.4.1 ç”¨æˆ·ç™»å½• (Login)

- **REQ_LOGIN** (Client -> Server)

  JSON

  ```
  {
      "msg_type": "REQ_LOGIN",
      "data": {
          "user_id": "20231345",   // å­¦å·æˆ–å·¥å·
          "password": "sha256_hash_string", // ã€ä¿®æ”¹ã€‘å»ºè®®å‰ç«¯ä½¿ç”¨ SHA256 åŠ å¯†ä¼ è¾“
          "role": 0                 // 0:å­¦ç”Ÿ, 1:æ•™èŒå·¥
      }
  }
  ```

- **RESP_LOGIN** (Server -> Client)

  JSON

  ```
  {
      "msg_type": "RESP_LOGIN",
      "data": {
          "code": 200,              // 200:æˆåŠŸ, 401:å¯†ç é”™è¯¯, 404:æ— ç”¨æˆ·
          "message": "Login Success",
          "user_info": {            // ç™»å½•æˆåŠŸåæºå¸¦åŸºç¡€ä¿¡æ¯
              "real_name": "å¼ ä¸‰",
              "balance": 50.00,
              "avatar_id": 1
          }
      }
  }
  ```

#### 5.4.2 åœ°å›¾ä¸åº“å­˜åŒæ­¥ (Map Sync)

æ­¤æŒ‡ä»¤ç”¨äºå®¢æˆ·ç«¯åˆå§‹åŒ–åœ°å›¾æ•£ç‚¹ï¼Œæˆ–å®šæ—¶è½®è¯¢åˆ·æ–°åº“å­˜çŠ¶æ€ã€‚

- **REQ_MAP_DATA** (Client -> Server)

  - `data` ä¸ºç©ºå¯¹è±¡ `{}` å³å¯ã€‚

- **RESP_MAP_DATA** (Server -> Client)

  JSON

  ```
  {
      "msg_type": "RESP_MAP_DATA",
      "data": {
          "stations": [
              {
                  "station_id": 1,
                  "name": "æ–‡å¾·æ¥¼",
                  "pos_x": 0.50,       // åœ°å›¾ç›¸å¯¹åæ ‡ X
                  "pos_y": 0.30,       // åœ°å›¾ç›¸å¯¹åæ ‡ Y
                  "status": 1,         // 1:åœ¨çº¿, 0:ç¦»çº¿
                  "inventory": {       // ç”¨äºæ°”æ³¡å¼¹çª—æ˜¾ç¤º
                      "umbrella": 10,
                      "raincoat": 5
                  }
              },
              {
                  "station_id": 2,
                  "name": "è¥¿è‹‘é£Ÿå ‚",
                  "pos_x": 0.20,
                  "pos_y": 0.80,
                  "status": 1,
                  "inventory": { "umbrella": 0, "raincoat": 2 }
              }
          ]
      }
  }
  ```

#### 5.4.3 å€Ÿé›¨å…·ä¸šåŠ¡ (Borrow)

- **REQ_BORROW** (Client -> Server)

  JSON

  ```
  {
      "msg_type": "REQ_BORROW",
      "data": {
          "user_id": "20231345",
          "gear_id": "RFID_001",    // é›¨å…·å”¯ä¸€èŠ¯ç‰‡å·
          "station_id": 1,          // å½“å‰æ‰€åœ¨ç«™ç‚¹
          "slot_id": 5              // ç‰©ç†æ§½ä½å·
      }
  }
  ```

- **RESP_BORROW** (Server -> Client)

  JSON

  ```
  {
      "msg_type": "RESP_BORROW",
      "data": {
          "code": 200,
          "message": "Success",
          "slot_action": 5,         // æŒ‡ä»¤ï¼šå¼¹å¼€5å·é”
          "new_balance": 30.00      // æ‰£é™¤æŠ¼é‡‘åçš„ä½™é¢
      }
  }
  ```

#### 5.4.4 è¿˜é›¨å…·ä¸šåŠ¡ (Return)

- **REQ_RETURN** (Client -> Server)

  JSON

  ```
  {
      "msg_type": "REQ_RETURN",
      "data": {
          "gear_id": "RFID_001",    // è¯»åˆ°çš„èŠ¯ç‰‡å·
          "station_id": 1,
          "slot_id": 8              // æ’å…¥çš„æ§½ä½
      }
  }
  ```

- **RESP_RETURN** (Server -> Client)

  JSON

  ```
  {
      "msg_type": "RESP_RETURN",
      "data": {
          "code": 200,
          "message": "Return Success",
          "cost": 2.00,             // æœ¬æ¬¡æ¶ˆè´¹
          "refund_deposit": 20.00,  // é€€è¿˜æŠ¼é‡‘
          "total_balance": 48.00    // æœ€æ–°ä½™é¢
      }
  }
  ```





## 6. æ ¸å¿ƒä¸šåŠ¡æµç¨‹ä¸æ—¶åº (Core Business Logic & Sequence)

æœ¬ç« èŠ‚æè¿°ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½çš„æ‰§è¡Œæ­¥éª¤ã€‚æˆ‘ä»¬ä½¿ç”¨ **æ—¶åºå›¾ (Sequence Diagram)** æ¥è§„å®šå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ä¸æ•°æ®åº“ä¸‰è€…ä¹‹é—´çš„äº¤äº’é¡ºåºã€‚

> **ç»™å¼€å‘è€…çš„æç¤º**ï¼šè¯·ä¸¥æ ¼éµå®ˆä»¥ä¸‹é€»è¾‘é¡ºåºï¼Œç‰¹åˆ«æ˜¯**æ•°æ®åº“äº‹åŠ¡**çš„å¤„ç†ï¼Œå¿…é¡»ä¿è¯â€œæ‰£è´¹â€å’Œâ€œå€Ÿå‡ºâ€ä¸¤ä¸ªåŠ¨ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚

### 6.1 å€Ÿé›¨å…·æµç¨‹ (Borrow Workflow)

è¿™æ˜¯ç³»ç»Ÿæœ€é¢‘ç¹ä½¿ç”¨çš„åœºæ™¯ã€‚

**ä¸šåŠ¡é€»è¾‘æè¿°**ï¼š

1. ç”¨æˆ·åœ¨å®¢æˆ·ç«¯ç‚¹å‡»æŸä¸ªç»¿è‰²çš„é›¨å…·æ§½ä½ã€‚
2. å®¢æˆ·ç«¯å†»ç»“ç•Œé¢ï¼Œæ˜¾ç¤ºâ€œæ­£åœ¨å¤„ç†...â€ï¼Œé˜²æ­¢ç”¨æˆ·é‡å¤ç‚¹å‡»ã€‚
3. æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œä¾æ¬¡æ ¡éªŒï¼š**ç”¨æˆ·æ˜¯å¦å­˜åœ¨** -> **ä½™é¢æ˜¯å¦å……è¶³(>20å…ƒ)** -> **é›¨å…·æ˜¯å¦è¿˜åœ¨**ã€‚
4. æ ¡éªŒé€šè¿‡åï¼ŒæœåŠ¡ç«¯æ‰§è¡Œæ•°æ®åº“æ‰£æ¬¾å’Œåº“å­˜æ›´æ–°ï¼Œå¹¶è®°å½•æµæ°´ã€‚
5. æœåŠ¡ç«¯è¿”å› `SUCCESS` æŒ‡ä»¤ã€‚
6. å®¢æˆ·ç«¯æ”¶åˆ°æŒ‡ä»¤ï¼Œé©±åŠ¨ç¡¬ä»¶å¼¹å¼€é”æ‰£ï¼Œå¹¶æç¤ºç”¨æˆ·å–èµ°ã€‚

**æ—¶åºå›¾ (Mermaid Code)**ï¼š

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·(User)
    participant Client as å®¢æˆ·ç«¯(Client)
    participant Server as æœåŠ¡ç«¯(Server)
    participant DB as æ•°æ®åº“(MySQL)

    User->>Client: ç‚¹å‡»å€Ÿä¼æŒ‰é’®(Select Slot)
    Note over Client: 1. é”å®šç•Œé¢ï¼Œè½¬åœˆç­‰å¾…
    Client->>Server: å‘é€ REQ_BORROW(JSON)
    
    Note over Server: 2. æ”¶åˆ°è¯·æ±‚ï¼Œå¼€å§‹æ ¡éªŒ
    Server->>DB: æŸ¥è¯¢ç”¨æˆ·ä½™é¢(SELECT balance)
    DB-->>Server: è¿”å› 50.00å…ƒ
    
    alt ä½™é¢å……è¶³(>= 20.00)
        Server->>DB: æŸ¥è¯¢é›¨å…·çŠ¶æ€(SELECT status)
        
        alt é›¨å…·å¯å€Ÿ(Status == 1)
            Note over Server: 3. å¼€å¯äº‹åŠ¡(Transaction)
            Server->>DB: UPDATE t_user SET balance = balance - 20
            Server->>DB: UPDATE t_rain_gear SET status = 2
            Server->>DB: INSERT INTO t_record ...
            
            Server-->>Client: å‘é€ RESP_BORROW(Code: 200, å¼€é”æŒ‡ä»¤)
            Client->>User: ç¡¬ä»¶å¼¹é” + è¯­éŸ³æç¤º "è¯·å–ä¼"
            Client->>Client: åˆ·æ–°ç•Œé¢(è¯¥æ§½ä½å˜ç°)
        else é›¨å…·æ•…éšœæˆ–å·²å€Ÿå‡º
            Server-->>Client: å‘é€ RESP_BORROW(Code: 409, å€Ÿå‡ºå¤±è´¥)
            Client->>User: å¼¹çª—æç¤º "æ‰‹æ…¢äº†ï¼Œè¯¥ä¼å·²è¢«å€Ÿèµ°"
        end
        
    else ä½™é¢ä¸è¶³
        Server-->>Client: å‘é€ RESP_BORROW(Code: 402, ä½™é¢ä¸è¶³)
        Client->>User: å¼¹çª—æç¤º "ä½™é¢ä¸è¶³ï¼Œè¯·å……å€¼"
    end
    
    Note over Client: 4. è§£é”ç•Œé¢
```

### 6.2 è¿˜é›¨å…·æµç¨‹ (Return Workflow)

æ­¤æµç¨‹ç”±**ç¡¬ä»¶è§¦å‘**ï¼ˆç”¨æˆ·å°†ä¼æ’å…¥æœºå™¨ï¼‰ï¼Œè€Œéç•Œé¢ç‚¹å‡»è§¦å‘ã€‚

**ä¸šåŠ¡é€»è¾‘æè¿°**ï¼š

1. ç”¨æˆ·å°†é›¨å…·æ’å…¥ç©ºé—²æ§½ä½ï¼ŒRFID è¯»å¡å™¨è¯»å–åˆ°èŠ¯ç‰‡ IDã€‚
2. å®¢æˆ·ç«¯ç«‹åˆ»å‘é€ `REQ_RETURN` ç»™æœåŠ¡ç«¯ã€‚
3. æœåŠ¡ç«¯è®¡ç®—æ—¶é•¿è´¹ç”¨ï¼š`å½“å‰æ—¶é—´ - å€Ÿå‡ºæ—¶é—´`ã€‚
4. æœåŠ¡ç«¯è®¡ç®—é€€æ¬¾é‡‘é¢ï¼š`æŠ¼é‡‘ - æ—¶é•¿è´¹`ã€‚
5. æ•°æ®åº“æ›´æ–°ï¼šæ¢å¤åº“å­˜çŠ¶æ€ï¼Œé€€è¿˜ç”¨æˆ·ä½™é¢ï¼Œæ›´æ–°è®¢å•ç»“æŸæ—¶é—´ã€‚
6. å®¢æˆ·ç«¯æ˜¾ç¤ºâ€œå½’è¿˜æˆåŠŸâ€å¹¶å±•ç¤ºæ‰£è´¹è¯¦æƒ…ã€‚

**æ—¶åºå›¾ (Mermaid Code)**ï¼š

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Hardware as ç¡¬ä»¶ä¼ æ„Ÿå™¨
    participant Client as å®¢æˆ·ç«¯
    participant Server as æœåŠ¡ç«¯
    participant DB as æ•°æ®åº“

    User->>Hardware: æ’å…¥é›¨å…·(Insert Gear)
    Hardware->>Client: æ£€æµ‹åˆ° RFID èŠ¯ç‰‡(Signal)
    Client->>Server: å‘é€ REQ_RETURN(JSON)
    
    Note over Server: 1. æŸ¥æ‰¾å¯¹åº”çš„å€Ÿå‡ºè®¢å•
    Server->>DB: SELECT * FROM t_record WHERE status=Unfinished
    
    Note over Server: 2. è®¡è´¹é€»è¾‘
    Server->>Server: Calculate Cost(æ—¶é•¿è´¹)
    
    Note over Server: 3. æ•°æ®åº“ç»“ç®—
    Server->>DB: UPDATE t_user(é€€è¿˜å‰©ä½™æŠ¼é‡‘)
    Server->>DB: UPDATE t_rain_gear(è®¾ä¸ºå¯å€Ÿ, æ›´æ–°ä½ç½®)
    
    Server-->>Client: å‘é€ RESP_RETURN(Code: 200, cost=2.00)
    
    Client->>User: å±å¹•æ˜¾ç¤º "å½’è¿˜æˆåŠŸï¼Œæ‰£è´¹ 2.00å…ƒ"
    Client->>Client: å°†è¯¥æ§½ä½å˜ä¸ºç»¿è‰²(å¯ç”¨)
```

### 6.3 å¼‚å¸¸å¤„ç†æœºåˆ¶ (Exception Handling)

ä¸ºäº†é˜²æ­¢è½¯ä»¶å´©æºƒï¼Œç³»ç»Ÿå¿…é¡»å…·å¤‡å¤„ç†â€œæ„å¤–æƒ…å†µâ€çš„èƒ½åŠ›ã€‚

#### 6.3.1 ç½‘ç»œè¶…æ—¶ (Network Timeout)

- **åœºæ™¯**ï¼šå®¢æˆ·ç«¯å‘äº† `REQ_BORROW`ï¼Œä½†æœåŠ¡å™¨æ–­ç½‘äº†ï¼Œæˆ–è€…æ•°æ®åŒ…ä¸¢äº†ã€‚
- **å¤„ç†ç­–ç•¥**ï¼š
  - å®¢æˆ·ç«¯åœ¨å‘é€è¯·æ±‚åï¼Œç«‹å³å¯åŠ¨ä¸€ä¸ª **5ç§’å®šæ—¶å™¨ (QTimer)**ã€‚
  - å¦‚æœ 5ç§’å†…æ”¶åˆ°äº† `RESP`ï¼Œåˆ™å…³é—­å®šæ—¶å™¨ï¼Œæ­£å¸¸å¤„ç†ã€‚
  - å¦‚æœ 5ç§’åå®šæ—¶å™¨è§¦å‘ï¼ˆå³è¿˜æ²¡æ”¶åˆ°å›å¤ï¼‰ï¼š
    1. å–æ¶ˆè½¬åœˆç­‰å¾…åŠ¨ç”»ã€‚
    2. å¼¹å‡ºæç¤ºæ¡†ï¼š**â€œç½‘ç»œè¿æ¥è¶…æ—¶ï¼Œè¯·é‡è¯•â€**ã€‚
    3. **ä¸æ‰§è¡Œ**ä»»ä½•ç¡¬ä»¶å¼€é”åŠ¨ä½œã€‚

#### 6.3.2 ç¡¬ä»¶æ•…éšœ (Hardware Error)

- **åœºæ™¯**ï¼šæœåŠ¡å™¨ä¸‹å‘äº†â€œå¼€é”â€æŒ‡ä»¤ï¼Œä½†å®¢æˆ·ç«¯ç¡¬ä»¶å¡ä½äº†ï¼Œé”æ²¡å¼¹å¼€ã€‚
- **å¤„ç†ç­–ç•¥**ï¼š
  - å®¢æˆ·ç«¯æ•è·ç¡¬ä»¶æŠ¥é”™ä¿¡å·ã€‚
  - ç«‹å³å‘é€ `REQ_REPORT_ERROR` ç»™æœåŠ¡ç«¯ï¼ˆè‡ªåŠ¨æ•…éšœä¸ŠæŠ¥ï¼‰ã€‚
  - æœåŠ¡ç«¯æ”¶åˆ°åï¼Œå°†è¯¥æ§½ä½åœ¨æ•°æ®åº“ä¸­æ ‡æ³¨ä¸º **status=2 (æ•…éšœ)**ï¼Œé˜²æ­¢å…¶ä»–äººå†æ¬¡å€Ÿç”¨ã€‚

### 6.4 ç¡¬ä»¶åŠ¨ä½œçš„è½¯ä»¶æ¨¡æ‹Ÿç­–ç•¥ (Hardware Simulation Strategy)

åŸºäº 3.1.4 ç« èŠ‚å®šä¹‰çš„ç•Œé¢äº¤äº’è§„èŒƒï¼Œæœ¬ç³»ç»Ÿé‡‡ç”¨ **â€œäº‹ä»¶é©±åŠ¨ + å®šæ—¶å™¨å»¶æ—¶â€** çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œåœ¨é€»è¾‘å±‚å®Œæ•´æ˜ å°„äº†çœŸå®çš„ç‰©ç†ç¡¬ä»¶åŠ¨ä½œã€‚

#### 1. å€Ÿå‡ºåŠ¨ä½œæ˜ å°„ (Borrowing Simulation)

å¯¹åº” 3.1.4 ä¸­ **åœºæ™¯ A** çš„æè¿°ï¼Œé€»è¾‘å±‚é€šè¿‡å›¾æ ‡çŠ¶æ€åˆ‡æ¢ä¸åŠ¨ç”»æ¥æ¨¡æ‹Ÿç‰©ç†å€Ÿå‡ºè¿‡ç¨‹ï¼š

| **ç‰©ç†ç¡¬ä»¶åŠ¨ä½œ**   | **è½¯ä»¶é€»è¾‘å®ç° (Logic)**             | **å¯¹åº” UI è¡¨ç° (View 3.1.4)** |
| ------------------ | ------------------------------------ | ----------------------------- |
| **æœåŠ¡å™¨ä¸‹å‘æŒ‡ä»¤** | æ¥æ”¶ TCP `RESP:BORROW` åŒ…            | è§¦å‘æœ¬åœ°æ§½ä½çŠ¶æ€å˜æ›´          |
| **ç”µç£é”å¼¹å¼€**     | çŠ¶æ€åˆ·æ–°ä¿¡å·                         | å›¾æ ‡ç”± `ğŸ”’` å˜ä¸º `ğŸ”“`           |
| **ç”¨æˆ·å–èµ°ç‰©å“**   | å¯åŠ¨ **FadeOut åŠ¨ç”»** (æ¨¡æ‹Ÿç‰©ä½“ç¦»å¼€) | é›¨å…·å›¾æ ‡é€æ¸æ·¡å‡º (Fade Out)   |
| **çº¢å¤–ä¼ æ„Ÿå™¨å¤ä½** | åŠ¨ç”»ç»“æŸä¿¡å· `finished()`            | èƒŒæ™¯å˜ç° (Empty)ï¼Œæ ‡è®°ä¸ºç©ºæ§½  |

#### 2. å½’è¿˜åŠ¨ä½œæ˜ å°„ (Returning Simulation)

å¯¹åº” 3.1.4 ä¸­ **åœºæ™¯ B** çš„æè¿°ï¼Œé€»è¾‘å±‚åˆ©ç”¨å»¶æ—¶æœºåˆ¶æ¨¡æ‹Ÿä¼ æ„Ÿå™¨çš„è¯»å–è€—æ—¶ï¼š

| **ç‰©ç†ç¡¬ä»¶åŠ¨ä½œ**  | **è½¯ä»¶é€»è¾‘å®ç° (Logic)**           | **å¯¹åº” UI è¡¨ç° (View 3.1.4)**  |
| ----------------- | ---------------------------------- | ------------------------------ |
| **æ’å…¥é›¨å…·**      | **ç‚¹å‡»äº‹ä»¶** (Signal: `clicked()`) | ç”¨æˆ·ç‚¹å‡»ç°è‰²çš„ç©ºé—²æ§½ä½         |
| **RFID å°„é¢‘è¯»å–** | å¯åŠ¨ **1.5ç§’ QTimer å®šæ—¶å™¨**       | å¼¹å‡ºâ€œæ­£åœ¨æ£€æµ‹...â€è¿›åº¦æ¡çª—å£    |
| **èŠ¯ç‰‡æ•°æ®ä¸ŠæŠ¥**  | å®šæ—¶å™¨ç»“æŸ -> å‘é€ `REQ:RETURN`    | è¿›åº¦æ¡å…³é—­ï¼Œå‘é€ç½‘ç»œåŒ…         |
| **è®¾å¤‡è½é”**      | æ¥æ”¶ TCP `RESP:RETURN` åŒ…          | æ§½ä½èƒŒæ™¯ç¬é—´å˜ç»¿ï¼Œå›¾æ ‡é‡æ–°å‡ºç° |





## 7. å·¥ç¨‹ç›®å½•ç»“æ„ä¸ä»£ç ç»„ç»‡ (Project Directory Structure)

æœ¬ç« èŠ‚ä¸ºå¼€å‘é˜¶æ®µçš„â€œæ–½å·¥å›¾çº¸â€ã€‚ä¸ºäº†ç¡®ä¿å®¢æˆ·ç«¯ï¼ˆClientï¼‰ä¸æœåŠ¡ç«¯ï¼ˆServerï¼‰ä»£ç çš„ç‹¬ç«‹æ€§ï¼ŒåŒæ—¶ä¾¿äºç®¡ç†å…¬ç”¨ä»£ç ï¼ˆå¦‚é€šä¿¡åè®®å®šä¹‰ï¼‰ï¼Œæˆ‘ä»¬å°†å·¥ç¨‹åˆ’åˆ†ä¸º**ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—**ã€‚

å»ºè®®åœ¨ Qt Creator ä¸­ä½¿ç”¨ **"Subdirs Project" (å­ç›®å½•é¡¹ç›®)** æ¨¡å¼è¿›è¡Œç®¡ç†ï¼Œæˆ–è€…å»ºç«‹ä¸¤ä¸ªç‹¬ç«‹çš„ `.pro` å·¥ç¨‹ã€‚

### 7.1 æ ¹ç›®å½•è§„åˆ’ (Root Directory)

Plaintext

```
RainHub_System/          <-- é¡¹ç›®æ€»æ ¹ç›®å½•
â”œâ”€â”€ RainHub_Client/      <-- [å®¢æˆ·ç«¯] è¿è¡Œåœ¨è§¦æ§ç»ˆç«¯çš„ä»£ç 
â”œâ”€â”€ RainHub_Server/      <-- [æœåŠ¡ç«¯] è¿è¡Œåœ¨æ§åˆ¶ä¸­å¿ƒçš„ä»£ç 
â”œâ”€â”€ Common/              <-- [å…¬å…±åº“] å­˜æ”¾å‰åç«¯å…±ç”¨çš„å¤´æ–‡ä»¶
â”œâ”€â”€ Docs/                <-- [æ–‡æ¡£] å­˜æ”¾æœ¬é¡¹ç›®è®¾è®¡æ–‡æ¡£åŠç´ æ
â””â”€â”€ README.md            <-- é¡¹ç›®è¯´æ˜æ–‡ä»¶
```

### 7.2 å…¬å…±æ¨¡å— (Common Module)

æ­¤æ–‡ä»¶å¤¹å­˜æ”¾å‰åç«¯å¿…é¡»ä¿æŒä¸€è‡´çš„å®šä¹‰ï¼Œ**ä¸¥ç¦**åœ¨æ­¤å¤„ç¼–å†™å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚

Plaintext

```
Common/
â”œâ”€â”€ GlobalDefs.h         // å®šä¹‰å…¨å±€æšä¸¾ï¼šStationCode, GearType
â”œâ”€â”€ Protocol.h           // å®šä¹‰ JSON é€šä¿¡æŒ‡ä»¤é›†ï¼šREQ_LOGIN, RESP_BORROW ç­‰
â””â”€â”€ Utils.h              // ç®€å•çš„é€šç”¨å·¥å…·å‡½æ•°ï¼ˆå¦‚æ—¶é—´æˆ³è½¬æ¢ï¼‰
```

### 7.3 å®¢æˆ·ç«¯å·¥ç¨‹ç»“æ„ (RainHub_Client)

å®¢æˆ·ç«¯é‡ç‚¹åœ¨äº **ç•Œé¢äº¤äº’ (UI)** å’Œ **ç½‘ç»œè¯·æ±‚å‘é€**ã€‚å®ƒ**ä¸åŒ…å«**ä»»ä½•æ•°æ®åº“æ“ä½œä»£ç ã€‚

Plaintext

```
RainHub_Client/
â”œâ”€â”€ RainHub_Client.pro   // Qt å·¥ç¨‹é…ç½®æ–‡ä»¶
â”œâ”€â”€ main.cpp             // ç¨‹åºå…¥å£
â”œâ”€â”€ resources.qrc        // èµ„æºæ–‡ä»¶ (å­˜æ”¾å›¾æ ‡ã€åœ°å›¾å›¾ç‰‡)
â”‚
â”œâ”€â”€ Forms/               // [UIæ–‡ä»¶] .ui ç•Œé¢è®¾è®¡æ–‡ä»¶
â”‚   â”œâ”€â”€ MainWindow.ui
â”‚   â”œâ”€â”€ LoginDialog.ui
â”‚   â”œâ”€â”€ MapWidget.ui
â”‚   â””â”€â”€ SlotItem.ui      // è‡ªå®šä¹‰æ§ä»¶çš„ç•Œé¢
â”‚
â”œâ”€â”€ App/                 // [æ ¸å¿ƒåº”ç”¨å±‚]
â”‚   â”œâ”€â”€ RainHubApp.h/.cpp       // å…¨å±€å•ä¾‹ï¼Œç®¡ç†ç”¨æˆ·ä¿¡æ¯
â”‚   â””â”€â”€ NetworkManager.h/.cpp   // è´Ÿè´£ TCP å‘åŒ…ä¸æ”¶åŒ…
â”‚
â”œâ”€â”€ View/                // [è§†å›¾å±‚ä»£ç ] å¯¹åº” Forms
â”‚   â”œâ”€â”€ MainWindow.h/.cpp
â”‚   â”œâ”€â”€ LoginDialog.h/.cpp
â”‚   â”œâ”€â”€ CampusMap.h/.cpp        // åœ°å›¾ç»˜åˆ¶é€»è¾‘
â”‚   â””â”€â”€ Component/              // è‡ªå®šä¹‰å°ç»„ä»¶
â”‚       â”œâ”€â”€ SlotItem.h/.cpp     // é›¨å…·æ§½ä½æ§ä»¶ (ç»§æ‰¿ QWidget)
â”‚       â””â”€â”€ MapHotspot.h/.cpp   // åœ°å›¾æ•£ç‚¹æ§ä»¶ (ç»§æ‰¿ QPushButton)
â”‚
â””â”€â”€ Model/               // [æ•°æ®æ¨¡å‹]
    â”œâ”€â”€ CurrentUser.h    // å½“å‰ç™»å½•ç”¨æˆ·ç±» (å®¢æˆ·ç«¯ç‰ˆ)
    â””â”€â”€ RainGear.h       // é›¨å…·åŸºç±» (ç”¨äº UI å¤šæ€æ˜¾ç¤º)
```

> **æ¶æ„å¸ˆæç¤º**ï¼šå®¢æˆ·ç«¯çš„ `Model` ä»…ç”¨äºå­˜å‚¨ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„ä¸´æ—¶æ•°æ®ï¼Œ**ä¸è¦**åœ¨å®¢æˆ·ç«¯è¿æ¥ MySQLã€‚

### 7.4 æœåŠ¡ç«¯å·¥ç¨‹ç»“æ„ (RainHub_Server)

æœåŠ¡ç«¯é‡ç‚¹åœ¨äº **æ•°æ®åº“æ“ä½œ (DAO)**ã€**å¹¶å‘å¤„ç†** å’Œ **ä¸šåŠ¡é€»è¾‘ (Service)**ã€‚å®ƒ**ä¸éœ€è¦**å¤æ‚çš„ UIï¼ˆé™¤éæ˜¯åå°ç®¡ç†ç•Œé¢ï¼‰ã€‚

Plaintext

```
RainHub_Server/
â”œâ”€â”€ RainHub_Server.pro
â”œâ”€â”€ main.cpp
â”‚
â”œâ”€â”€ Core/                // [æ ¸å¿ƒæ§åˆ¶å±‚]
â”‚   â”œâ”€â”€ ServerListener.h/.cpp   // QTcpServer ç›‘å¬å™¨
â”‚   â”œâ”€â”€ ClientSocket.h/.cpp     // å¤„ç†å•ä¸ªå®¢æˆ·ç«¯è¿æ¥ (QRunnable/QThread)
â”‚   â””â”€â”€ SystemManager.h/.cpp    // ä¸šåŠ¡é€»è¾‘æ€»æ§ (å€Ÿè¿˜è§„åˆ™åˆ¤å®š)
â”‚
â”œâ”€â”€ DAO/                 // [æ•°æ®åº“è®¿é—®å±‚] ç›´æ¥æ“ä½œ MySQL
â”‚   â”œâ”€â”€ DBHelper.h/.cpp         // æ•°æ®åº“è¿æ¥æ± å•ä¾‹
â”‚   â”œâ”€â”€ UserDAO.h/.cpp          // t_user è¡¨å¢åˆ æ”¹æŸ¥
â”‚   â”œâ”€â”€ RainGearDAO.h/.cpp      // t_rain_gear è¡¨æ“ä½œ
â”‚   â””â”€â”€ RecordDAO.h/.cpp        // t_record è¡¨æ“ä½œ
â”‚
â”œâ”€â”€ Model/               // [æœåŠ¡ç«¯æ•°æ®æ¨¡å‹]
â”‚   â”œâ”€â”€ User.h
â”‚   â”œâ”€â”€ RainGear.h              // ä¸å®¢æˆ·ç«¯çš„ Model ç±»ä¼¼ï¼Œä½†åŒ…å«æ›´å¤šå­—æ®µ
â”‚   â”œâ”€â”€ Umbrella.h              // å…·ä½“çš„ä¼ç±» (ç»§æ‰¿è‡ª RainGear)
â”‚   â””â”€â”€ Raincoat.h              // å…·ä½“çš„é›¨è¡£ç±»
â”‚
â””â”€â”€ View/                // [åå°ç®¡ç†ç•Œé¢]
    â”œâ”€â”€ ServerWindow.ui/.h/.cpp // ç›‘æ§å¤§å±
    â””â”€â”€ LogWidget.h/.cpp        // å®æ—¶æ—¥å¿—çª—å£
```

### 7.5 å¼€å‘ç¯å¢ƒé…ç½®å»ºè®®

- **IDE**: Qt Creator 10.0+
- **Qt Version**: Qt 6.5 LTS (æ¨è) æˆ– Qt 5.15 LTS
- **Compiler**: MinGW 64-bit (Windows) æˆ– GCC (Linux)
- **Database**: MySQL 8.0 Community Server
- **Encoding**: æºç æ–‡ä»¶ç»Ÿä¸€ä½¿ç”¨ **UTF-8 with BOM** ç¼–ç ï¼Œé˜²æ­¢ä¸­æ–‡ä¹±ç ã€‚